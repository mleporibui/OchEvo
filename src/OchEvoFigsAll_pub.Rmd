---
title: "OchEvo_figs"
author: "Michelle Lepori-Bui"
date: "11/3/2021"
output: html_document
---

# Ochromonas Evolution Data Analysis

Setup/packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
# Load packages
library(here)
library(sciplot) 
library(Rmisc) 
library(tidyverse)
library(pracma)
library(broom)
library(ggpubr)
library(scales)
library(ggthemes)
library(devtools)
devtools::install_github("ctkremer/growthTools@develop") #development branch of growthTools package for thermal response curves
library(growthTools)
library(ggplot2)
library(dplyr)
library(tidyr)
library(mleTools)
library(reshape2)

#COLORS
hcol <- rgb(192/256,80/256,77/256,.75)
lcol <- rgb(79/256,129/256,189/256,.75)
mcol <- rgb(155/256,187/256,89/256,.75)
hcol2 <- rgb(192/256,80/256,77/256)
lcol2 <- rgb(79/256,129/256,189/256)
mcol2 <- rgb(155/256,187/256,89/256)
tempcol<-c(lcol,mcol,hcol)
tempcol2<-c(lcol2,mcol2,hcol2)
newcols<-c(lcol2,"gray48",hcol2)
```

Data import and wrangling
```{r}
# Import composite data sheets, change formats, and do some calculations

dat100<-read_csv(here::here("data","OECD100.csv"))
dat50<-read_csv(here::here("data","OECD50.csv"))

# experiment time in days days
dat100$Days <- dat100$Week *7
dat50$Days <- dat50$Week *7

#fix import errors
dat100$Chl.a.per.cell <- as.numeric(as.character(dat100$Chl.a.per.cell))
dat100$O2.Count <- as.numeric(as.character(dat100$O2.Count))
dat100$PE.Count <- as.numeric(as.character(dat100$PE.Count))
dat50$Chl.a.per.cell <- as.numeric(as.character(dat50$Chl.a.per.cell))
dat50$O2.Count <- as.numeric(as.character(dat50$O2.Count))
dat50$PE.Count <- as.numeric(as.character(dat50$PE.Count))

# Photosynthesis in O2 per cell per day (12 hours/day of light), Respiration in O2 per cell per day (24 hours/day)

dat100$pgO2.cell.phot.day <- (dat100$pgO2.cell.hr.light-dat100$pgO2.cell.hr.dark)*12
dat100$pgO2.cell.day <- dat100$pgO2.cell.hr.dark*24*-1 # Respiration in O2 per cell per day
dat50$pgO2.cell.phot.day <- (dat50$pgO2.cell.hr.light-dat50$pgO2.cell.hr.dark)*12
dat50$pgO2.cell.day <- dat50$pgO2.cell.hr.dark*24*-1 

# convert units from O2 to C later in code, set up calculations for M now
# CN ratio, M (species-specific assimilation quotient from Falkowski et al 1985)   
dat100$CN <- dat100$pgC.cell/dat100$pgN.cell
dat50$CN <- dat50$pgC.cell/dat50$pgN.cell
dat100$C_moles <- dat100$pgC.cell * 1e-12 * 0.083259093974539
dat100$N_moles <- dat100$pgN.cell * 1e-12 * 0.071394404106606
dat100$C_N_moles <- dat100$C_moles/dat100$N_moles
dat100$M <- dat100$C_N_moles/(dat100$C_N_moles+2)
dat50$C_moles <- dat50$pgC.cell * 1e-12 * 0.083259093974539
dat50$N_moles <- dat50$pgN.cell * 1e-12 * 0.071394404106606
dat50$C_N_moles <- dat50$C_moles/dat50$N_moles
dat50$M <- dat50$C_N_moles/(dat50$C_N_moles+2)


# mean red fluorescence over 4-day reciprocal transfer exp.
dat100$Mean.redF <- (dat100$Day1.redF + dat100$Day2.redF + dat100$Day3.redF + dat100$Day4.redF) / 4
dat50$Mean.redF <- (dat50$Day1.redF + dat50$Day2.redF + dat50$Day3.redF + dat50$Day4.redF) / 4

# red fluorescence conversion to pg chlorophyll per cell
# these equations come from Jan 2021 Och_AcclimationTempCheck comparing extracted chlorophyll to redf

dat100<- dat100 %>% 
  mutate(redF.corr = case_when(
    Strain == "1393" ~ (2.732e-05)*(Mean.redF) + (6.702e-03) ,
    Strain == "2951" ~ (2.652e-05) * (Mean.redF) + (2.353e-02)
  ))
  dat50<- dat50 %>% 
  mutate(redF.corr = case_when(
    Strain == "1393" ~ (2.732e-05)*(Mean.redF) + (6.702e-03) ,
    Strain == "2951" ~ (2.652e-05) * (Mean.redF) + (2.353e-02)
  ))


# grazing: convert bact per per och per day to pgC per och per day 
# (pgC/och/day) = grazing rate (bact / och / hr) * 113.5996283 (fgC / bact) * 0.001 pg/fg * 24 (hr/day)
# value averaged from bacteria only CN samples 
dat100$graz.day <- dat100$G_O *24 * 113.5996283 * 0.001
dat50$graz.day <- dat50$G_O *24 * 113.5996283 * 0.001

# identifiers
dat100$ID <- paste(dat100$Strain,dat100$Ev,dat100$Acc,dat100$Rep,dat100$Week,sep='.')
dat100$Treat <- paste(dat100$Strain,dat100$Ev,dat100$Acc,sep='.')
dat100$Lineage <- paste(dat100$Strain,dat100$Ev,dat100$Acc,dat100$Rep,sep='.')
dat100$Treat.Acc <- paste(dat100$Strain,dat100$Acc,dat100$Rep,dat100$Week,sep='.')

dat50$ID <- paste(dat50$Strain,dat50$Ev,dat50$Acc,dat50$Rep,dat50$Week,sep='.')
dat50$Treat <- paste(dat50$Strain,dat50$Ev,dat50$Acc,sep='.')
dat50$Lineage <- paste(dat50$Strain,dat50$Ev,dat50$Acc,dat50$Rep,sep='.')
dat50$Treat.Acc <- paste(dat50$Strain,dat50$Acc,dat50$Rep,dat50$Week,sep='.')

```

Calculate generations elapsed per treatment based in growth rate and experimental time


```{r}
# First, create spline of growth rates over time, then calculate 

# list for for loops
strain<- c(1393,2951)
temps<- c(18,24,30)

# 100uE

## create dataframe for each treatment with growth rate

# total days of experiment
totdays100 <- max(dat100$Week) *7

for (s in 1:length(strain)){
  for (t in 1:length(temps)) {
    df <- dat100 %>% 
      select(Strain, Ev, Acc, Rep, Week, Days, Growth.Rate, Treat) %>% 
      filter(Strain == strain[s], Ev == temps[t], Acc == temps[t], !is.na(Growth.Rate))
   assign(paste("gr",strain[s],temps[t],"100",sep = "."), df) 
  }
}

## put all treatment dfs into a list
evol.grs.100<-list(gr.1393.18.100=gr.1393.18.100,
               gr.1393.24.100=gr.1393.24.100,
               gr.1393.30.100=gr.1393.30.100,
               gr.2951.18.100=gr.2951.18.100,
               gr.2951.24.100=gr.2951.24.100,
               gr.2951.30.100=gr.2951.30.100)

## create spline for each treatment, calculate to generations elapsed, 
 for (i in 1:length(evol.grs.100)) {
   gr.spline<-smooth.spline(evol.grs.100[[i]]$Days,evol.grs.100[[i]]$Growth.Rate,  cv=TRUE)
   spline.result<-as.data.frame(predict(gr.spline,c(0:totdays100),deriv=0))
   spline.result$gens.per.day<- spline.result$y/log(2) 
   spline.result$gens.elaps<-cumtrapz(spline.result$x,spline.result$gens.per.day)
   assign(paste("sr.100",evol.grs.100[[i]]$Treat,sep = "."), spline.result)
 }

## repeat for 50 ue
totdays50 <- max(dat50$Week) *7

for (s in 1:length(strain)){
  for (t in 1:length(temps)) {
    df <- dat50 %>% 
      select(Strain, Ev, Acc, Rep, Week, Days, Growth.Rate, Treat) %>% 
      filter(Strain == strain[s], Ev == temps[t], Acc == temps[t], !is.na(Growth.Rate))
   assign(paste("gr",strain[s],temps[t],"50",sep = "."), df) 
  }
}

evol.grs.50<-list(gr.1393.18.50=gr.1393.18.50,
               gr.1393.24.50=gr.1393.24.50,
               gr.1393.30.50=gr.1393.30.50,
               gr.2951.18.50=gr.2951.18.50,
               gr.2951.24.50=gr.2951.24.50,
               gr.2951.30.50=gr.2951.30.50)

 for (i in 1:length(evol.grs.50)) {
   gr.spline<-smooth.spline(evol.grs.50[[i]]$Days,evol.grs.50[[i]]$Growth.Rate,  cv=TRUE)
   spline.result<-as.data.frame(predict(gr.spline,c(0:totdays50),deriv=0))
   spline.result$gens.per.day<- spline.result$y/log(2) 
   spline.result$gens.elaps<-cumtrapz(spline.result$x,spline.result$gens.per.day)
   assign(paste("sr.50",evol.grs.50[[i]]$Treat,sep = "."), spline.result)
 }

# treatment-specific generations elapsed
dat100<- dat100 %>%
 mutate(gens.elaps = case_when(
    Strain == 1393 & Ev == 18|Strain == 1393 & Ev == 24 & Acc ==18  ~ sr.100.1393.18.18$gens.elaps[match(dat100$Days,sr.100.1393.18.18$x)],
    Strain == 2951 & Ev == 18|Strain == 2951 & Ev == 24 & Acc ==18  ~ sr.100.2951.18.18$gens.elaps[match(dat100$Days,sr.100.2951.18.18$x)],
    Strain == 1393 & Ev == 30|Strain == 1393 & Ev == 24 & Acc ==30  ~ sr.100.1393.30.30$gens.elaps[match(dat100$Days,sr.100.1393.30.30$x)],
    Strain == 2951 & Ev == 30|Strain == 2951 & Ev == 24 & Acc ==30  ~ sr.100.2951.30.30$gens.elaps[match(dat100$Days,sr.100.2951.30.30$x)],
    Strain == 1393 & Ev == 24 & Acc == 24 ~ sr.100.1393.24.24$gens.elaps[match(dat100$Days,sr.100.1393.24.24$x)],
    Strain == 2951 & Ev == 24 & Acc == 24 ~ sr.100.2951.24.24$gens.elaps[match(dat100$Days,sr.100.2951.24.24$x)]
    ))

dat50<- dat50 %>%
 mutate(gens.elaps = case_when(
    Strain == 1393 & Ev == 18|Strain == 1393 & Ev == 24 & Acc ==18  ~ sr.50.1393.18.18$gens.elaps[match(dat50$Days,sr.50.1393.18.18$x)],
    Strain == 2951 & Ev == 18|Strain == 2951 & Ev == 24 & Acc ==18  ~ sr.50.2951.18.18$gens.elaps[match(dat50$Days,sr.50.2951.18.18$x)],
    Strain == 1393 & Ev == 30|Strain == 1393 & Ev == 24 & Acc ==30  ~ sr.50.1393.30.30$gens.elaps[match(dat50$Days,sr.50.1393.30.30$x)],
    Strain == 2951 & Ev == 30|Strain == 2951 & Ev == 24 & Acc ==30  ~ sr.50.2951.30.30$gens.elaps[match(dat50$Days,sr.50.2951.30.30$x)],
    Strain == 1393 & Ev == 24 & Acc == 24 ~ sr.50.1393.24.24$gens.elaps[match(dat50$Days,sr.50.1393.24.24$x)],
    Strain == 2951 & Ev == 24 & Acc == 24 ~ sr.50.2951.24.24$gens.elaps[match(dat50$Days,sr.50.2951.24.24$x)]
    ))

```

Extract data for specific variables from composite data sheet into their own data frames to compare between treatments:

Growth rate, Red F.C, and FvFm grouped from quarterly backtransfers

```{r,fig.height=6,fig.width=8, echo = FALSE, warning = FALSE}

# make data frame to process growth rate, redf, and fvfm from backtransfer experiments
# growth is in units 'per day'
# convert red f from units of pg chla per cell (redf.corr) to ug chlorophyll per g C (redf.c) by dividing by pgC per cell
# ug chla / g C = (pg chla/cell) / (pgC/cell) * 1000 
# first match CN values by ID for calculations

cn_hold100 <- dat100 %>% 
  filter(Week == 141)
growth_hold100 <- dat100 %>% 
  filter( !is.na (Growth.Rate))
growth_hold100$ID <- paste(growth_hold100$Strain,growth_hold100$Ev,growth_hold100$Acc,growth_hold100$Rep,growth_hold100$Week,sep='.')
growth_hold100$C141 <- cn_hold100$pgC.cell[match(growth_hold100$Lineage,cn_hold100$Lineage)]
growth_hold100$redf.C <- (growth_hold100$redF.corr / growth_hold100$C141) * 1000
growth_hold100$Treat.Acc <- paste(growth_hold100$Strain,growth_hold100$Acc,growth_hold100$Rep,growth_hold100$Week,sep='.')
growths100 <- as.data.frame(unique(growth_hold100$ID))
# make data frame
names(growths100) <- 'ID'
growths100$Treat.Acc <- growth_hold100$Treat.Acc[match(growths100$ID,growth_hold100$ID)]
growths100$Treat <- growth_hold100$Treat[match(growths100$ID,growth_hold100$ID)]
growths100$Lineage <- growth_hold100$Lineage[match(growths100$ID,growth_hold100$ID)]
growths100$Strain <- growth_hold100$Strain[match(growths100$ID,growth_hold100$ID)]
growths100$Ev <- growth_hold100$Ev[match(growths100$ID,growth_hold100$ID)]
growths100$Acc <- growth_hold100$Acc[match(growths100$ID,growth_hold100$ID)]
growths100$Rep <- growth_hold100$Rep[match(growths100$ID,growth_hold100$ID)]
growths100$Week <- growth_hold100$Week[match(growths100$ID,growth_hold100$ID)]
growths100$gens.elaps <- growth_hold100$gens.elaps[match(growths100$ID,growth_hold100$ID)]
growths100$Growth.Rate <- growth_hold100$Growth.Rate[match(growths100$ID,growth_hold100$ID)]
# Match evolved & ancestral reference points
growths100$Growth.Rate.ref <- growth_hold100[growth_hold100$Ev==24,]$Growth.Rate[match(growths100$Treat.Acc,growth_hold100[growth_hold100$Ev==24,]$Treat.Acc)] 
growths100$redf <- growth_hold100$redf.C[match(growths100$ID,growth_hold100$ID)]
growths100$redf.ref <- growth_hold100[growth_hold100$Ev==24,]$redf.C[match(growths100$Treat.Acc,growth_hold100[growth_hold100$Ev==24,]$Treat.Acc)] 
growths100$fvfm <- growth_hold100$FvFm.PE[match(growths100$ID,growth_hold100$ID)]
growths100$fvfm.ref <- growth_hold100[growth_hold100$Ev==24,]$FvFm.PE[match(growths100$Treat.Acc,growth_hold100[growth_hold100$Ev==24,]$Treat.Acc)] 
#calculate deltas between evolved and ancestral reference points
growths100$Growth.propdel <- (growths100$Growth.Rate-growths100$Growth.Rate.ref)/abs(growths100$Growth.Rate.ref) # Compute rel. difference
growths100$Growth.del <- (growths100$Growth.Rate-growths100$Growth.Rate.ref) # Compute abs difference
growths100$redf.propdel <- (growths100$redf-growths100$redf.ref)/abs(growths100$redf.ref) # Compute rel. difference
growths100$redf.del <- (growths100$redf-growths100$redf.ref) # Compute abs difference
growths100$fvfm.propdel <- (growths100$fvfm-growths100$fvfm.ref)/abs(growths100$fvfm.ref) # Compute rel. difference
growths100$fvfm.del <- (growths100$fvfm-growths100$fvfm.ref) # Compute abs difference

#add redf.corr no C for supp fig
growths100$redf.corr <- dat100$redF.corr[match(growths100$ID,dat100$ID)]
growths100$redf.corr.ref <- dat100[dat100$Ev==24,]$redF.corr[match(growths100$Treat.Acc,dat100[dat100$Ev==24,]$Treat.Acc)] 
growths100$redf.corr.propdel <- (growths100$redf.corr-growths100$redf.corr.ref)/abs(growths100$redf.corr.ref) # Compute rel. difference
growths100$redf.corr.del <- (growths100$redf.corr-growths100$redf.corr.ref) # Compute abs difference


growths100 <- growths100[!is.na(growths100$Growth.Rate),]
growths100<- growths100[growths100$Strain != 1391,]

# Repeat same for 50uE
cn_hold50 <- dat50 %>% 
  filter(Week == 141)
growth_hold50 <- dat50 %>% 
  filter( !is.na (Growth.Rate))
growth_hold50$ID <- paste(growth_hold50$Strain,growth_hold50$Ev,growth_hold50$Acc,growth_hold50$Rep,growth_hold50$Week,sep='.')
growth_hold50$C141 <- cn_hold50$pgC.cell[match(growth_hold50$Lineage,cn_hold50$Lineage)]
growth_hold50$redf.C <- (growth_hold50$redF.corr / growth_hold50$C141) *1000
growth_hold50$Treat.Acc <- paste(growth_hold50$Strain,growth_hold50$Acc,growth_hold50$Rep,growth_hold50$Week,sep='.')
growths50 <- as.data.frame(unique(growth_hold50$ID))
names(growths50) <- 'ID'
growths50$Treat.Acc <- growth_hold50$Treat.Acc[match(growths50$ID,growth_hold50$ID)]
growths50$Treat <- growth_hold50$Treat[match(growths50$ID,growth_hold50$ID)]
growths50$Lineage <- growth_hold50$Lineage[match(growths50$ID,growth_hold50$ID)]
growths50$Strain <- growth_hold50$Strain[match(growths50$ID,growth_hold50$ID)]
growths50$Ev <- growth_hold50$Ev[match(growths50$ID,growth_hold50$ID)]
growths50$Acc <- growth_hold50$Acc[match(growths50$ID,growth_hold50$ID)]
growths50$Rep <- growth_hold50$Rep[match(growths50$ID,growth_hold50$ID)]
growths50$Week <- growth_hold50$Week[match(growths50$ID,growth_hold50$ID)]
growths50$gens.elaps <- growth_hold50$gens.elaps[match(growths50$ID,growth_hold50$ID)]
# Match evolved & ancestral reference points
growths50$Growth.Rate <- growth_hold50$Growth.Rate[match(growths50$ID,growth_hold50$ID)]
growths50$Growth.Rate.ref <- growth_hold50[growth_hold50$Ev==24,]$Growth.Rate[match(growths50$Treat.Acc,growth_hold50[growth_hold50$Ev==24,]$Treat.Acc)] 
growths50$redf <- growth_hold50$redf.C[match(growths50$ID,growth_hold50$ID)]
growths50$redf.ref <- growth_hold50[growth_hold50$Ev==24,]$redf.C[match(growths50$Treat.Acc,growth_hold50[growth_hold50$Ev==24,]$Treat.Acc)] 
growths50$fvfm <- growth_hold50$FvFm.PE[match(growths50$ID,growth_hold50$ID)]
growths50$fvfm.ref <- growth_hold50[growth_hold50$Ev==24,]$FvFm.PE[match(growths50$Treat.Acc,growth_hold50[growth_hold50$Ev==24,]$Treat.Acc)] 
#calculate deltas
growths50$Growth.propdel <- (growths50$Growth.Rate-growths50$Growth.Rate.ref)/abs(growths50$Growth.Rate.ref) # Compute rel. difference
growths50$Growth.del <- (growths50$Growth.Rate-growths50$Growth.Rate.ref) # Compute abs difference
growths50$redf.propdel <- (growths50$redf-growths50$redf.ref)/abs(growths50$redf.ref) # Compute rel. difference
growths50$redf.del <- (growths50$redf-growths50$redf.ref) # Compute abs difference
growths50$fvfm.propdel <- (growths50$fvfm-growths50$fvfm.ref)/abs(growths50$fvfm.ref) # Compute rel. difference
growths50$fvfm.del <- (growths50$fvfm-growths50$fvfm.ref) # Compute abs difference

growths50 <- growths50[!is.na(growths50$Growth.Rate),]

#add redf.corr no C for supp fig
growths50$redf.corr <- dat50$redF.corr[match(growths50$ID,dat50$ID)]
growths50$redf.corr.ref <- dat50[dat50$Ev==24,]$redF.corr[match(growths50$Treat.Acc,dat50[dat50$Ev==24,]$Treat.Acc)] 
growths50$redf.corr.propdel <- (growths50$redf.corr-growths50$redf.corr.ref)/abs(growths50$redf.corr.ref) # Compute rel. difference
growths50$redf.corr.del <- (growths50$redf.corr-growths50$redf.corr.ref) # Compute abs difference

```

Carbon per cell 

```{r}

# data frame for cellular CN content 

cn.100 <- as.data.frame(unique(dat100$ID))
names(cn.100) <- 'ID'
cn.100$Treat.Acc <- dat100$Treat.Acc[match(cn.100$ID,dat100$ID)]
cn.100$Lineage <- dat100$Lineage[match(cn.100$ID,dat100$ID)]
cn.100$Strain <- dat100$Strain[match(cn.100$ID,dat100$ID)]
cn.100$Ev <- dat100$Ev[match(cn.100$ID,dat100$ID)]
cn.100$Acc <- dat100$Acc[match(cn.100$ID,dat100$ID)]
cn.100$Rep <- dat100$Rep[match(cn.100$ID,dat100$ID)]
cn.100$Week <- dat100$Week[match(cn.100$ID,dat100$ID)]
cn.100$gens.elaps <- dat100$gens.elaps[match(cn.100$ID,dat100$ID)]
# Match Evolved & ancestral reference points
cn.100$C <- dat100$pgC.cell[match(cn.100$ID,dat100$ID)]
cn.100$C.ref <- dat100[dat100$Ev==24,]$pgC.cell[match(cn.100$Treat.Acc,dat100[dat100$Ev==24,]$Treat.Acc)] 
# calculate deltas
cn.100$C.propdel <- (cn.100$C-cn.100$C.ref)/abs(cn.100$C.ref) # Compute rel. difference
cn.100$C.del <- (cn.100$C-cn.100$C.ref) # Compute abs difference
# N
# Match Evolved & ancestral reference points
cn.100$N <- dat100$pgN.cell[match(cn.100$ID,dat100$ID)]
cn.100$N.ref <- dat100[dat100$Ev==24,]$pgN.cell[match(cn.100$Treat.Acc,dat100[dat100$Ev==24,]$Treat.Acc)] 
# calculate deltas
cn.100$N.propdel <- (cn.100$N-cn.100$N.ref)/abs(cn.100$N.ref) # Compute rel. difference
cn.100$N.del <- (cn.100$N-cn.100$N.ref) # Compute abs difference
cn.100 <- cn.100[!is.na(cn.100$N),]

# repeat for 50ue
cn.50 <- as.data.frame(unique(dat50$ID))
names(cn.50) <- 'ID'
cn.50$Treat.Acc <- dat50$Treat.Acc[match(cn.50$ID,dat50$ID)]
cn.50$Lineage <- dat50$Lineage[match(cn.50$ID,dat50$ID)]
cn.50$Strain <- dat50$Strain[match(cn.50$ID,dat50$ID)]
cn.50$Ev <- dat50$Ev[match(cn.50$ID,dat50$ID)]
cn.50$Acc <- dat50$Acc[match(cn.50$ID,dat50$ID)]
cn.50$Rep <- dat50$Rep[match(cn.50$ID,dat50$ID)]
cn.50$Week <- dat50$Week[match(cn.50$ID,dat50$ID)]
cn.50$gens.elaps <- dat50$gens.elaps[match(cn.50$ID,dat50$ID)]
# Match evolved & ancestral reference points
cn.50$C <- dat50$pgC.cell[match(cn.50$ID,dat50$ID)]
cn.50$C.ref <- dat50[dat50$Ev==24,]$pgC.cell[match(cn.50$Treat.Acc,dat50[dat50$Ev==24,]$Treat.Acc)] 
# calculate deltas
cn.50$C.propdel <- (cn.50$C-cn.50$C.ref)/abs(cn.50$C.ref) # Compute rel. difference
cn.50$C.del <- (cn.50$C-cn.50$C.ref) # Compute abs difference
cn.50 <- cn.50[!is.na(cn.50$C),]

# N
# Match Evolved & ancestral reference points
cn.50$N <- dat50$pgN.cell[match(cn.50$ID,dat50$ID)]
cn.50$N.ref <- dat50[dat50$Ev==24,]$pgN.cell[match(cn.50$Treat.Acc,dat50[dat50$Ev==24,]$Treat.Acc)] 
# calculate deltas
cn.50$N.propdel <- (cn.50$N-cn.50$N.ref)/abs(cn.50$N.ref) # Compute rel. difference
cn.50$N.del <- (cn.50$N-cn.50$N.ref) # Compute abs difference
cn.50 <- cn.50[!is.na(cn.50$N),]

```

Respiration and photosynthesis from optode in pgC/pgC per day == gC per gC per day

```{r, echo = FALSE, warning = FALSE}
# Convert metabolic rates from O2 per mL per s to pgC per cell per day (Barton et al 2020) using CN data from Week 141
# resp/photo (pgC/och*day) = resp/photo(pgO2/cell*day) * 0.000001 (ug/pg) * 0.031251171918947 (umolsO2/ugO2) * M *32 *(12/44)

cn_hold100 <- dat100 %>% 
  filter(Week == 141)
resp_hold100 <- dat100 %>% 
  filter( !is.na (pgO2.cell.day))
resp_hold100$ID <- paste(resp_hold100$Strain,resp_hold100$Ev,resp_hold100$Acc,resp_hold100$Rep,resp_hold100$Week,sep='.')
resp_hold100$C141 <- cn_hold100$pgC.cell[match(resp_hold100$Lineage,cn_hold100$Lineage)]
resp_hold100$N141 <- cn_hold100$pgN.cell[match(resp_hold100$Lineage,cn_hold100$Lineage)]
# calculate C and N in moles
resp_hold100$C_moles <- resp_hold100$C141 * 1e-12 * 0.083259093974539
resp_hold100$N_moles <- resp_hold100$N141 * 1e-12 * 0.071394404106606
resp_hold100$C_N_moles <- resp_hold100$C_moles/resp_hold100$N_moles
# calculate M, species-specific assimilation quotient from Falkowski et al 1985 as n/n+2 where n is the c:n ratio
resp_hold100$M <- resp_hold100$C_N_moles/(resp_hold100$C_N_moles+2)
# convert to units of pgC per cell per day with equation from Barton et al 2020.
resp_hold100$respiration <- resp_hold100$pgO2.cell.day *0.031251171918947 * 0.000001 *resp_hold100$M  * 32 * (12/44) * 1000000
# convert to pgC per pgC per day
resp_hold100$respiration.perC <- resp_hold100$respiration / resp_hold100$C141
# repeat with photosuynthesis
resp_hold100$photosynth <- resp_hold100$pgO2.cell.phot.day *0.031251171918947 * 0.000001 *resp_hold100$M  * 32 * (12/44) * 1000000
resp_hold100$photosynth.perC <- resp_hold100$photosynth / resp_hold100$C141

# repeat with 50uE
cn_hold50 <- dat50 %>% 
  filter(Week == 141)
resp_hold50 <- dat50 %>% 
  filter( !is.na (pgO2.cell.day))
resp_hold50$ID <- paste(resp_hold50$Strain,resp_hold50$Ev,resp_hold50$Acc,resp_hold50$Rep,resp_hold50$Week,sep='.')
resp_hold50$C141 <- cn_hold50$pgC.cell[match(resp_hold50$Lineage,cn_hold50$Lineage)]
resp_hold50$N141 <- cn_hold50$pgN.cell[match(resp_hold50$Lineage,cn_hold50$Lineage)]
resp_hold50$C_moles <- resp_hold50$C141 * 1e-12 * 0.083259093974539
resp_hold50$N_moles <- resp_hold50$N141 * 1e-12 * 0.071394404106606
resp_hold50$C_N_moles <- resp_hold50$C_moles/resp_hold50$N_moles
resp_hold50$M <- resp_hold50$C_N_moles/(resp_hold50$C_N_moles+2)
resp_hold50$respiration <- resp_hold50$pgO2.cell.day *0.031251171918947 * 0.000001 *resp_hold50$M  * 32 * (12/44) * 1000000
resp_hold50$respiration.perC <- resp_hold50$respiration / resp_hold50$C141
resp_hold50$photosynth <- resp_hold50$pgO2.cell.phot.day *0.031251171918947 * 0.000001 *resp_hold50$M  * 32 * (12/44) * 1000000
resp_hold50$photosynth.perC <- resp_hold50$photosynth  / resp_hold50$C141

# Respiration calculations
resp_hold100$Treat.Acc <- paste(resp_hold100$Strain,resp_hold100$Acc,resp_hold100$Rep,resp_hold100$Week,sep='.')
resp.100 <- as.data.frame(unique(resp_hold100$ID))
names(resp.100) <- 'ID'
resp.100$Treat.Acc <- resp_hold100$Treat.Acc[match(resp.100$ID,resp_hold100$ID)]
resp.100$Lineage <- resp_hold100$Lineage[match(resp.100$ID,resp_hold100$ID)]
resp.100$Strain <- resp_hold100$Strain[match(resp.100$ID,resp_hold100$ID)]
resp.100$Ev <- resp_hold100$Ev[match(resp.100$ID,resp_hold100$ID)]
resp.100$Acc <- resp_hold100$Acc[match(resp.100$ID,resp_hold100$ID)]
resp.100$Rep <- resp_hold100$Rep[match(resp.100$ID,resp_hold100$ID)]
resp.100$Week <- resp_hold100$Week[match(resp.100$ID,resp_hold100$ID)]
resp.100$gens.elaps <- resp_hold100$gens.elaps[match(resp.100$ID,resp_hold100$ID)]
# Match evolved & ancestral reference points
resp.100$Resp <- resp_hold100$respiration.perC[match(resp.100$ID,resp_hold100$ID)]
resp.100$Resp.ref <- resp_hold100[resp_hold100$Ev==24,]$respiration.perC[match(resp.100$Treat.Acc,resp_hold100[resp_hold100$Ev==24,]$Treat.Acc)] 
resp.100$Photo <- resp_hold100$photosynth.perC[match(resp.100$ID,resp_hold100$ID)]
resp.100$Photo.ref <- resp_hold100[resp_hold100$Ev==24,]$photosynth.perC[match(resp.100$Treat.Acc,resp_hold100[resp_hold100$Ev==24,]$Treat.Acc)] 
# calculate deltas
resp.100$Resp.propdel <- (resp.100$Resp-resp.100$Resp.ref)/abs(resp.100$Resp.ref) # Compute rel. difference
resp.100$Resp.del <- (resp.100$Resp-resp.100$Resp.ref) # Compute abs difference
resp.100$Photo.propdel <- (resp.100$Photo-resp.100$Photo.ref)/abs(resp.100$Photo.ref) # Compute rel. difference
resp.100$Photo.del <- (resp.100$Photo-resp.100$Photo.ref) # Compute abs difference
resp.100 <- resp.100[!is.na(resp.100$Resp),]

# 50 ue Respiration calculations
resp_hold50$Treat.Acc <- paste(resp_hold50$Strain,resp_hold50$Acc,resp_hold50$Rep,resp_hold50$Week,sep='.')
resp.50 <- as.data.frame(unique(resp_hold50$ID))
names(resp.50) <- 'ID'
resp.50$Treat.Acc <- resp_hold50$Treat.Acc[match(resp.50$ID,resp_hold50$ID)]
resp.50$Lineage <- resp_hold50$Lineage[match(resp.50$ID,resp_hold50$ID)]
resp.50$Strain <- resp_hold50$Strain[match(resp.50$ID,resp_hold50$ID)]
resp.50$Ev <- resp_hold50$Ev[match(resp.50$ID,resp_hold50$ID)]
resp.50$Acc <- resp_hold50$Acc[match(resp.50$ID,resp_hold50$ID)]
resp.50$Rep <- resp_hold50$Rep[match(resp.50$ID,resp_hold50$ID)]
resp.50$Week <- resp_hold50$Week[match(resp.50$ID,resp_hold50$ID)]
resp.50$gens.elaps <- resp_hold50$gens.elaps[match(resp.50$ID,resp_hold50$ID)]
# Match evolved & ancestral reference points
resp.50$Resp <- resp_hold50$respiration.perC[match(resp.50$ID,resp_hold50$ID)]
resp.50$Resp.ref <- resp_hold50[resp_hold50$Ev==24,]$respiration.perC[match(resp.50$Treat.Acc,resp_hold50[resp_hold50$Ev==24,]$Treat.Acc)] 
resp.50$Photo <- resp_hold50$photosynth.perC[match(resp.50$ID,resp_hold50$ID)]
resp.50$Photo.ref <- resp_hold50[resp_hold100$Ev==24,]$photosynth.perC[match(resp.50$Treat.Acc,resp_hold50[resp_hold50$Ev==24,]$Treat.Acc)] 
# calculate deltas
resp.50$Resp.propdel <- (resp.50$Resp-resp.50$Resp.ref)/abs(resp.50$Resp.ref) # Compute rel. difference
resp.50$Resp.del <- (resp.50$Resp-resp.50$Resp.ref) # Compute abs difference
resp.50$Photo.propdel <- (resp.50$Photo-resp.50$Photo.ref)/abs(resp.50$Photo.ref) # Compute rel. difference
resp.50$Photo.del <- (resp.50$Photo-resp.50$Photo.ref) # Compute abs difference
resp.50 <- resp.50[!is.na(resp.50$Resp),]
```

Grazing in pgC per pgC per day == gC per gC per day

```{r, echo = FALSE, warning = FALSE}
# dataframes for grazing, convert to pgC per pgC per day using CN data from week141

# 100uE convert from pgC per cell to pgC per pgC using CN data from week 141
cn_hold100 <- dat100 %>% 
  filter(Week == 141)
graz_hold100 <- dat100 %>% 
  filter( !is.na (graz.day))
graz_hold100$ID <- paste(graz_hold100$Strain,graz_hold100$Ev,graz_hold100$Acc,graz_hold100$Rep,graz_hold100$Week,sep='.')
graz_hold100$C141 <- cn_hold100$pgC.cell[match(graz_hold100$Lineage,cn_hold100$Lineage)]
# convert from pgC per cell to pgC per pgC
graz_hold100$graz.C.day <- graz_hold100$graz.day / graz_hold100$C141

#repeat with 50uE
cn_hold50 <- dat50 %>% 
  filter(Week == 141)
graz_hold50 <- dat50 %>% 
  filter( !is.na (graz.day))
graz_hold50$ID <- paste(graz_hold50$Strain,graz_hold50$Ev,graz_hold50$Acc,graz_hold50$Rep,graz_hold50$Week,sep='.')
graz_hold50$C141 <- cn_hold50$pgC.cell[match(graz_hold50$Lineage,cn_hold50$Lineage)]
graz_hold50$graz.C.day <- graz_hold50$graz.day / graz_hold50$C141

# grazing data frame 
graz_hold100$Treat.Acc <- paste(graz_hold100$Strain,graz_hold100$Acc,graz_hold100$Rep,graz_hold100$Week,sep='.')
graz.100 <- as.data.frame(unique(graz_hold100$ID))
names(graz.100) <- 'ID'
graz.100$Treat.Acc <- graz_hold100$Treat.Acc[match(graz.100$ID,graz_hold100$ID)]
graz.100$Lineage <- graz_hold100$Lineage[match(graz.100$ID,graz_hold100$ID)]
graz.100$Strain <- graz_hold100$Strain[match(graz.100$ID,graz_hold100$ID)]
graz.100$Ev <- graz_hold100$Ev[match(graz.100$ID,graz_hold100$ID)]
graz.100$Acc <- graz_hold100$Acc[match(graz.100$ID,graz_hold100$ID)]
graz.100$Rep <- graz_hold100$Rep[match(graz.100$ID,graz_hold100$ID)]
graz.100$Week <- graz_hold100$Week[match(graz.100$ID,graz_hold100$ID)]
graz.100$gens.elaps <- graz_hold100$gens.elaps[match(graz.100$ID,graz_hold100$ID)]
graz.100$graz <- graz_hold100$graz.C.day[match(graz.100$ID,graz_hold100$ID)]
graz.100$graz.ref <- graz_hold100[graz_hold100$Ev==24,]$graz.C.day[match(graz.100$Treat.Acc,graz_hold100[graz_hold100$Ev==24,]$Treat.Acc)] 
graz.100 <- graz.100[!is.na(graz.100$graz),]

# Match evolved & ancestral reference points
graz.100$Grazing.propdel <- (graz.100$graz-graz.100$graz.ref)/abs(graz.100$graz.ref) # Compute rel. difference
graz.100$Grazing.del <- (graz.100$graz-graz.100$graz.ref) # Compute abs difference

# repeat for 50uE
graz_hold50$Treat.Acc <- paste(graz_hold50$Strain,graz_hold50$Acc,graz_hold50$Rep,graz_hold50$Week,sep='.')
graz.50 <- as.data.frame(unique(graz_hold50$ID))
names(graz.50) <- 'ID'
graz.50$Treat.Acc <- graz_hold50$Treat.Acc[match(graz.50$ID,graz_hold50$ID)]
graz.50$Lineage <- graz_hold50$Lineage[match(graz.50$ID,graz_hold50$ID)]
graz.50$Strain <- graz_hold50$Strain[match(graz.50$ID,graz_hold50$ID)]
graz.50$Ev <- graz_hold50$Ev[match(graz.50$ID,graz_hold50$ID)]
graz.50$Acc <- graz_hold50$Acc[match(graz.50$ID,graz_hold50$ID)]
graz.50$Rep <- graz_hold50$Rep[match(graz.50$ID,graz_hold50$ID)]
graz.50$Week <- graz_hold50$Week[match(graz.50$ID,graz_hold50$ID)]
graz.50$gens.elaps <- graz_hold50$gens.elaps[match(graz.50$ID,graz_hold50$ID)]
graz.50$graz <- graz_hold50$graz.C.day[match(graz.50$ID,graz_hold50$ID)]
graz.50$graz.ref <- graz_hold50[graz_hold50$Ev==24,]$graz.C.day[match(graz.50$Treat.Acc,graz_hold50[graz_hold50$Ev==24,]$Treat.Acc)] 
graz.50 <- graz.50[!is.na(graz.50$graz),]

# Match evolved & ancestral reference points
graz.50$Grazing.propdel <- (graz.50$graz-graz.50$graz.ref)/abs(graz.50$graz.ref) # Compute rel. difference
graz.50$Grazing.del <- (graz.50$graz-graz.50$graz.ref) # Compute abs difference



```

Carbon use efficiency

```{r}
# calculate carbon use efficiency end of experiment data points for growth rate and respiration 
# cue = net carbon gained/gross carbon gained = growth / (growth + respiration)

# 100uE CUE
CUE100_last3 <- growths100 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% c(125,140,154))
CUE100_last3$pgC.cell <- cn_hold100$pgC.cell[match(CUE100_last3$Lineage,cn_hold100$Lineage)]
CUE100_last3$gr.cell <- CUE100_last3$pgC.cell * CUE100_last3$Growth.Rate
# average growth and and respiration to calculate average cue
cue.gr.avg.100 <- summarySE(data = CUE100_last3, measurevar = 'gr.cell', groupvars = c('Strain', 'Ev', 'Acc', 'Rep'))
cue.gr.avg.100$ID <- paste(cue.gr.avg.100$Strain, cue.gr.avg.100$Ev, cue.gr.avg.100$Acc, cue.gr.avg.100$Rep, sep = ".")
cue.resp.avg.100 <- summarySE(data = resp.100, measurevar = 'Resp', groupvars = c('Strain', 'Ev', 'Acc', 'Rep'))
cue.resp.avg.100$ID <- paste(cue.resp.avg.100$Strain, cue.resp.avg.100$Ev, cue.resp.avg.100$Acc, cue.resp.avg.100$Rep, sep = ".")
cue.gr.avg.100$Resp.avg <- cue.resp.avg.100$Resp[match(cue.gr.avg.100$ID,cue.resp.avg.100$ID)]
cue.gr.avg.100$CUE <- cue.gr.avg.100$gr.cell / (cue.gr.avg.100$gr.cell + cue.gr.avg.100$Resp.avg)

# repeat for 50 ue
CUE50_last3 <- growths50 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% c(125,140,154))
CUE50_last3$pgC.cell <- cn_hold50$pgC.cell[match(CUE50_last3$Lineage,cn_hold50$Lineage)]
CUE50_last3$gr.cell <- CUE50_last3$pgC.cell * CUE50_last3$Growth.Rate
cue.gr.avg.50 <- summarySE(data = CUE50_last3, measurevar = 'gr.cell', groupvars = c('Strain', 'Ev', 'Acc', 'Rep'))
cue.gr.avg.50$ID <- paste(cue.gr.avg.50$Strain, cue.gr.avg.50$Ev, cue.gr.avg.50$Acc, cue.gr.avg.50$Rep, sep = ".")
cue.resp.avg.50 <- summarySE(data = resp.50, measurevar = 'Resp', groupvars = c('Strain', 'Ev', 'Acc', 'Rep'))
cue.resp.avg.50$ID <- paste(cue.resp.avg.50$Strain, cue.resp.avg.50$Ev, cue.resp.avg.50$Acc, cue.resp.avg.50$Rep, sep = ".")
cue.gr.avg.50$Resp.avg <- cue.resp.avg.50$Resp[match(cue.gr.avg.50$ID,cue.resp.avg.50$ID)]
cue.gr.avg.50$CUE <- cue.gr.avg.50$gr.cell / (cue.gr.avg.50$gr.cell + cue.gr.avg.50$Resp.avg)

```


### Growth TIMESERIES

T-testing

```{r}
# ttest for growth rate delta difference from 0

# TTEST FOR LOOP
ttest.df.100 <- growths100 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, gens.elaps, Growth.del) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24)
ttest.df.100$group <- paste(ttest.df.100$Strain,ttest.df.100$Ev,ttest.df.100$Acc,ttest.df.100$Week,sep='.')
#data frame to store results
pvals.df.100 <- as.data.frame(unique(ttest.df.100$group))
names(pvals.df.100) <- 'group'
pvals.df.100$Strain <- ttest.df.100$Strain[match(pvals.df.100$group,ttest.df.100$group)]
pvals.df.100$Ev <- ttest.df.100$Ev[match(pvals.df.100$group,ttest.df.100$group)]
pvals.df.100$Acc <- ttest.df.100$Acc[match(pvals.df.100$group,ttest.df.100$group)]
pvals.df.100$Week <- ttest.df.100$Week[match(pvals.df.100$group,ttest.df.100$group)]
pvals.df.100$gens.elaps <- ttest.df.100$gens.elaps[match(pvals.df.100$group,ttest.df.100$group)]
pvals.df.100$p.value <- NA

for(i in 1:dim(pvals.df.100)[1]){
  hold <-ttest.df.100[ttest.df.100$group==pvals.df.100$group[i],] %>% 
    pull(Growth.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100$p.value[i] <- tidy.hold$p.value }
  
pvals.df.100 <- pvals.df.100 %>% 
  mutate(signif.alpha = case_when(
    pvals.df.100$p.value <= .001 ~ 1,
    pvals.df.100$p.value >.001 & pvals.df.100$p.value <= .01 ~ .75,
    pvals.df.100$p.value > .01 & pvals.df.100$p.value <= .05 ~ .5,
    pvals.df.100$p.value > .05 ~ 0
  ))


# repeat for 50 uE
# TTEST FOR LOOP
ttest.df.50 <- growths50 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, gens.elaps, Growth.del) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24)
ttest.df.50$group <- paste(ttest.df.50$Strain,ttest.df.50$Ev,ttest.df.50$Acc,ttest.df.50$Week,sep='.')
# data frame to store results
pvals.df.50 <- as.data.frame(unique(ttest.df.50$group))
names(pvals.df.50) <- 'group'
pvals.df.50$Strain <- ttest.df.50$Strain[match(pvals.df.50$group,ttest.df.50$group)]
pvals.df.50$Ev <- ttest.df.50$Ev[match(pvals.df.50$group,ttest.df.50$group)]
pvals.df.50$Acc <- ttest.df.50$Acc[match(pvals.df.50$group,ttest.df.50$group)]
pvals.df.50$Week <- ttest.df.50$Week[match(pvals.df.50$group,ttest.df.50$group)]
pvals.df.50$gens.elaps <- ttest.df.50$gens.elaps[match(pvals.df.50$group,ttest.df.50$group)]
pvals.df.50$p.value <- NA

for(i in 1:dim(pvals.df.50)[1]){
  hold <-ttest.df.50[ttest.df.50$group==pvals.df.50$group[i],] %>% 
    pull(Growth.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.50$p.value[i] <- tidy.hold$p.value }
  
pvals.df.50 <- pvals.df.50 %>% 
  mutate(signif.alpha = case_when(
    pvals.df.50$p.value <= .001 ~ 1,
    pvals.df.50$p.value >.001 & pvals.df.50$p.value <= .01 ~ .75,
    pvals.df.50$p.value > .01 & pvals.df.50$p.value <= .05 ~ .5,
    pvals.df.50$p.value > .05 ~ 0
  ))
```

Timeseries plot - alpha pvals

```{r,fig.height=8}

Growth.summ.100 <- summarySE(data=growths100,measurevar='Growth.Rate',groupvars=c('Strain','Ev','Acc','gens.elaps','Week'))
Del.Growth.summ.100 <- summarySE(data=growths100,measurevar='Growth.del',groupvars=c('Strain','Ev','Acc','gens.elaps','Week'))

Growth.summ.50 <- summarySE(data=growths50,measurevar='Growth.Rate',groupvars=c('Strain','Ev','Acc','gens.elaps','Week'))
Del.Growth.summ.50 <- summarySE(data=growths50,measurevar='Growth.del',groupvars=c('Strain','Ev','Acc','gens.elaps', 'Week'))



par(mar=c(5,6,0,0),mgp=c(3,2,0),mfrow=c(2,2))

ptcex <- 5
labelcex <- 3
lwdset<- 6
maincex <- 3

# for legend
lp1<- expression(italic(p) < 0.001 )
lp2<- expression(italic(p) < 0.01 )
lp3<- expression(italic(p) < 0.05 )
lp4<- expression(italic(p) > 0.05 )

xtick<- seq(0,1250, by=200)
ytick<-seq(-.4,.8, by=.2)

## 1393 100
strainchoice <- 1393
tempchoice <- 18
del <- Del.Growth.summ.100[Del.Growth.summ.100$Strain==strainchoice & Del.Growth.summ.100$Acc==tempchoice & Del.Growth.summ.100$Ev==Del.Growth.summ.100$Acc,]
del$group <- paste(del$Strain,del$Ev,del$Acc,del$Week,sep='.')
del$signif <- pvals.df.100$signif[match(del$group,pvals.df.100$group)]
del$signif.val <- pvals.df.100$signif.val[match(del$group,pvals.df.100$group)]
del$signif.alpha <- pvals.df.100$signif.alpha[match(del$group,pvals.df.100$group)]

plot(del$gens.elaps,del$Growth.del,ylim=c(-.4,.8),type='n',ylab='',xlab='',xaxt = 'n', las=1,xlim=c(0,900),cex.lab=labelcex,cex.axis=labelcex,cex.main=maincex); 
axis(side=1, at=xtick, labels = FALSE);
abline(h=0); lines(del$gens.elaps,del$Growth.del,col=lcol2,lwd=lwdset); arrows(del$gens.elaps,del$Growth.del+del$sd,del$gens.elaps,del$Growth.del-del$sd,code=3,length=.1,angle=90); 
points(del$gens.elaps,del$Growth.del,pch=21,col = lcol2,bg = "white", cex=ptcex, lwd = lwdset); points(del$gens.elaps,del$Growth.del,pch=19,col = alpha(lcol2, alpha = del$signif.alpha),cex=ptcex)
# text(del$gens.elaps, .7,  del$signif,
#      cex=5,col=lcol2,srt=-90, pos=1) 

tempchoice <- 30
del <- Del.Growth.summ.100[Del.Growth.summ.100$Strain==strainchoice & Del.Growth.summ.100$Acc==tempchoice & Del.Growth.summ.100$Ev==Del.Growth.summ.100$Acc,]
del$group <- paste(del$Strain,del$Ev,del$Acc,del$Week,sep='.')
del$signif <- pvals.df.100$signif[match(del$group,pvals.df.100$group)]
del$signif.val <- pvals.df.100$signif.val[match(del$group,pvals.df.100$group)]
del$signif.alpha <- pvals.df.100$signif.alpha[match(del$group,pvals.df.100$group)]

arrows(del$gens.elaps,del$Growth.del+del$sd,del$gens.elaps,del$Growth.del-del$sd,code=3,length=.1,angle=90); lines(del$gens.elaps,del$Growth.del,col=hcol2,lwd=lwdset); points(del$gens.elaps,del$Growth.del,pch=21,col = hcol2,bg = "white", cex=ptcex, lwd = lwdset)
points(del$gens.elaps,del$Growth.del,pch=19,col = alpha(hcol2, alpha = del$signif.alpha),cex=ptcex)
#text(-3,.7,'Relative Growth',cex=labelcex,pos=4)
# text(del$gens.elaps, .7,  del$signif,
#      cex=5,col=hcol2,srt=-90, pos=1) 

## 2951 100
strainchoice <- 2951
tempchoice <- 18
del <- Del.Growth.summ.100[Del.Growth.summ.100$Strain==strainchoice & Del.Growth.summ.100$Acc==tempchoice & Del.Growth.summ.100$Ev==Del.Growth.summ.100$Acc,]
del$group <- paste(del$Strain,del$Ev,del$Acc,del$Week,sep='.')
del$signif <- pvals.df.100$signif[match(del$group,pvals.df.100$group)]
del$signif.val <- pvals.df.100$signif.val[match(del$group,pvals.df.100$group)]
del$signif.alpha <- pvals.df.100$signif.alpha[match(del$group,pvals.df.100$group)]
xtick <- seq(0,1300, by = 200)
plot(del$gens.elaps,del$Growth.del,ylim=c(-.4,.8),type='n',ylab='',xlab='',xaxt = 'n', yaxt = 'n', las=1,xlim=c(0,1300),cex.lab=labelcex,cex.axis=labelcex,cex.main=maincex); abline(h=0);
axis(side=1, at=xtick, labels = FALSE);
axis(side=2, at=ytick, labels = FALSE);
lines(del$gens.elaps,del$Growth.del,col=lcol2,lwd=lwdset); arrows(del$gens.elaps,del$Growth.del+del$sd,del$gens.elaps,del$Growth.del-del$sd,code=3,length=.1,angle=90); 
points(del$gens.elaps,del$Growth.del,pch=21,col = lcol2,bg = "white", cex=ptcex, lwd = lwdset)
points(del$gens.elaps,del$Growth.del,pch=19,col = alpha(lcol2, alpha = del$signif.alpha),cex=ptcex)
# text(del$gens.elaps, .7,  del$signif,
#      cex=5,col=lcol2,srt=-90, pos=1) 

tempchoice <- 30
del <- Del.Growth.summ.100[Del.Growth.summ.100$Strain==strainchoice & Del.Growth.summ.100$Acc==tempchoice & Del.Growth.summ.100$Ev==Del.Growth.summ.100$Acc,]
del$group <- paste(del$Strain,del$Ev,del$Acc,del$Week,sep='.')
del$signif <- pvals.df.100$signif[match(del$group,pvals.df.100$group)]
del$signif.val <- pvals.df.100$signif.val[match(del$group,pvals.df.100$group)]
del$signif.alpha <- pvals.df.100$signif.alpha[match(del$group,pvals.df.100$group)]

arrows(del$gens.elaps,del$Growth.del+del$sd,del$gens.elaps,del$Growth.del-del$sd,code=3,length=.1,angle=90); lines(del$gens.elaps,del$Growth.del,col=hcol2,lwd=lwdset); points(del$gens.elaps,del$Growth.del,pch=21,col = hcol2,bg = "white", cex=ptcex, lwd = lwdset)
points(del$gens.elaps,del$Growth.del,pch=19,col = alpha(hcol2, alpha = del$signif.alpha),cex=ptcex)
# text(del$gens.elaps, .7,  del$signif,
#      cex=5,col=hcol2,srt=-90, pos=1) 
#text(-3,.7,'Relative Growth',cex=labelcex,pos=4)


## 1393 50
strainchoice <- 1393
tempchoice <- 18
del <- Del.Growth.summ.50[Del.Growth.summ.50$Strain==strainchoice & Del.Growth.summ.50$Acc==tempchoice & Del.Growth.summ.50$Ev==Del.Growth.summ.50$Acc,]
del$group <- paste(del$Strain,del$Ev,del$Acc,del$Week,sep='.')
del$signif <- pvals.df.50$signif[match(del$group,pvals.df.50$group)]
del$signif.val <- pvals.df.50$signif.val[match(del$group,pvals.df.50$group)]
del$signif.alpha <- pvals.df.50$signif.alpha[match(del$group,pvals.df.50$group)]

plot(del$gens.elaps,del$Growth.del,ylim=c(-.4,.8),type='n',ylab='',xlab='',las=1,xlim=c(0,900),cex.lab=labelcex,cex.axis=labelcex,cex.main=maincex); abline(h=0); lines(del$gens.elaps,del$Growth.del,col=lcol2,lwd=lwdset); arrows(del$gens.elaps,del$Growth.del+del$sd,del$gens.elaps,del$Growth.del-del$sd,code=3,length=.1,angle=90); 
points(del$gens.elaps,del$Growth.del,pch=21,col = lcol2,bg = "white", cex=ptcex, lwd = lwdset)
points(del$gens.elaps,del$Growth.del,pch=19,col = alpha(lcol2, alpha = del$signif.alpha),cex=ptcex)
# text(del$gens.elaps, .7,  del$signif,
#      cex=5,col=lcol2,srt=-90, pos=1) 

tempchoice <- 30
del <- Del.Growth.summ.50[Del.Growth.summ.50$Strain==strainchoice & Del.Growth.summ.50$Acc==tempchoice & Del.Growth.summ.50$Ev==Del.Growth.summ.50$Acc,]
del$group <- paste(del$Strain,del$Ev,del$Acc,del$Week,sep='.')
del$signif <- pvals.df.50$signif[match(del$group,pvals.df.50$group)]
del$signif.val <- pvals.df.50$signif.val[match(del$group,pvals.df.50$group)]
del$signif.alpha <- pvals.df.50$signif.alpha[match(del$group,pvals.df.50$group)]

arrows(del$gens.elaps,del$Growth.del+del$sd,del$gens.elaps,del$Growth.del-del$sd,code=3,length=.1,angle=90); lines(del$gens.elaps,del$Growth.del,col=hcol2,lwd=lwdset); points(del$gens.elaps,del$Growth.del,pch=21,col = hcol2,bg = "white", cex=ptcex, lwd = lwdset)
points(del$gens.elaps,del$Growth.del,pch=19,col = alpha(hcol2, alpha = del$signif.alpha),cex=ptcex)
#text(-3,.7,'Relative Growth',cex=labelcex,pos=4)
# text(del$gens.elaps, .7,  del$signif,
#      cex=5,col=hcol2,srt=-90, pos=1) 

## 2951 50 
strainchoice <- 2951
tempchoice <- 18
del <- Del.Growth.summ.50[Del.Growth.summ.50$Strain==strainchoice & Del.Growth.summ.50$Acc==tempchoice & Del.Growth.summ.50$Ev==Del.Growth.summ.50$Acc,]
del$group <- paste(del$Strain,del$Ev,del$Acc,del$Week,sep='.')
del$signif <- pvals.df.50$signif[match(del$group,pvals.df.50$group)]
del$signif.val <- pvals.df.50$signif.val[match(del$group,pvals.df.50$group)]
del$signif.alpha <- pvals.df.50$signif.alpha[match(del$group,pvals.df.50$group)]
ytick <- seq(0,1300,by=200)
plot(del$gens.elaps,del$Growth.del,ylim=c(-.4,.8),type='n',ylab='',xlab='',yaxt = 'n',
      las=1,xlim=c(0,1300),cex.lab=labelcex,cex.axis=labelcex,cex.main=maincex); 
axis(side=2, at=ytick, labels = FALSE);
abline(h=0); lines(del$gens.elaps,del$Growth.del,col=lcol2,lwd=lwdset);
arrows(del$gens.elaps,del$Growth.del+del$sd,del$gens.elaps,del$Growth.del-del$sd,code=3,length=.1,angle=90); 
points(del$gens.elaps,del$Growth.del,pch=21,col = lcol2,bg = "white", cex=ptcex, lwd = lwdset)
points(del$gens.elaps,del$Growth.del,pch=19,col = alpha(lcol2, alpha = del$signif.alpha),cex=ptcex)
# text(del$gens.elaps, .7,  del$signif,
#      cex=5,col=lcol2,srt=-90, pos=1) 

tempchoice <- 30
del <- Del.Growth.summ.50[Del.Growth.summ.50$Strain==strainchoice & Del.Growth.summ.50$Acc==tempchoice & Del.Growth.summ.50$Ev==Del.Growth.summ.50$Acc,]
del$group <- paste(del$Strain,del$Ev,del$Acc,del$Week,sep='.')
del$signif <- pvals.df.50$signif[match(del$group,pvals.df.50$group)]
del$signif.val <- pvals.df.50$signif.val[match(del$group,pvals.df.50$group)]
del$signif.alpha <- pvals.df.50$signif.alpha[match(del$group,pvals.df.50$group)]

arrows(del$gens.elaps,del$Growth.del+del$sd,del$gens.elaps,del$Growth.del-del$sd,code=3,length=.1,angle=90); 
lines(del$gens.elaps,del$Growth.del,col=hcol2,lwd=lwdset); points(del$gens.elaps,del$Growth.del,pch=21,col = hcol2,bg = "white", cex=ptcex, lwd = lwdset)
points(del$gens.elaps,del$Growth.del,pch=19,col = alpha(hcol2, alpha = del$signif.alpha),cex=ptcex)
#text(-3,.7,'Relative Growth',cex=labelcex,pos=4)
# text(del$gens.elaps, .7,  del$signif,
#      cex=5,col=hcol2,srt=-90, pos=1) 

legend(1000,0.8, legend = c(lp1,lp2,lp3,lp4), pch= c(21,21,21,21),col = "black", pt.bg = alpha("black", alpha = c(1,.75,.5,0)), pt.cex = ptcex, pt.lwd = lwdset, cex = labelcex )

#"p<0.001","p<0.01","p<0.05","p>.05"


```

### End of experiment evolutionary vs plastic responses

Summary stats for all parameters for last 2-3 measurements timepoints

```{r}
# Calculate summary stats at end of experiment 

# growth, redf, fvfm 
# 100 uE
growthsweekselection <- c(125,140,154)
growths100_last3<- growths100 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% growthsweekselection)
Growth.summ.100 <- summarySE(data=growths100_last3,measurevar='Growth.Rate',groupvars=c('Strain','Ev','Acc'))
Del.Growth.summ.100 <- summarySE(data=growths100_last3,measurevar='Growth.del',groupvars=c('Strain','Ev','Acc'))
redf.summ.100 <- summarySE(data=growths100_last3,measurevar='redf',groupvars=c('Strain','Ev','Acc'))
Del.redf.summ.100 <- summarySE(data=growths100_last3,measurevar='redf.del',groupvars=c('Strain','Ev','Acc'))
fvfm.summ.100 <- summarySE(data=growths100_last3,measurevar='fvfm',groupvars=c('Strain','Ev','Acc'))
Del.fvfm.summ.100 <- summarySE(data=growths100_last3,measurevar='fvfm.del',groupvars=c('Strain','Ev','Acc'))
# 50uE
growths50_last3<-growths50 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% growthsweekselection)
Growth.summ.50 <- summarySE(data=growths50_last3,measurevar='Growth.Rate',groupvars=c('Strain','Ev','Acc'))
redf.summ.50 <- summarySE(data=growths50_last3,measurevar='redf',groupvars=c('Strain','Ev','Acc'))
fvfm.summ.50 <- summarySE(data=growths50_last3,measurevar='fvfm',groupvars=c('Strain','Ev','Acc'))
Del.fvfm.summ.50 <- summarySE(data=growths50_last3,measurevar='fvfm.del',groupvars=c('Strain','Ev','Acc'))

# cn 
cn.100_last3<-cn.100 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% c(104,141))
C.summ.100 <- summarySE(data=cn.100_last3,measurevar='C',groupvars=c('Strain','Ev','Acc'))
cn.50_last3<-cn.50 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% c(104,141))
C.summ.50 <- summarySE(data=cn.50_last3,measurevar='C',groupvars=c('Strain','Ev','Acc'))
N.summ.100 <- summarySE(data=cn.100_last3,measurevar='N',groupvars=c('Strain','Ev','Acc'))
N.summ.50 <- summarySE(data=cn.50_last3,measurevar='N',groupvars=c('Strain','Ev','Acc'))
N.summ.100.2<- N.summ.100[,c(1,2,3,5,6,7,8)]
N.summ.50.2<- N.summ.50[,c(1,2,3,5,6,7,8)]

# respiration and photosynthesis
resp.100_last3<-resp.100 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% c(90,114,138))
Resp.summ.100 <- summarySE(data=resp.100_last3,measurevar='Resp',groupvars=c('Strain','Ev','Acc'))
Photo.summ.100 <- summarySE(data=resp.100_last3,measurevar='Photo',groupvars=c('Strain','Ev','Acc'))
resp.50_last3<-resp.50 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% c(90,114,138))
Resp.summ.50 <- summarySE(data=resp.50_last3,measurevar='Resp',groupvars=c('Strain','Ev','Acc'))
Photo.summ.50 <- summarySE(data=resp.50_last3,measurevar='Photo',groupvars=c('Strain','Ev','Acc'))

# grazing
graz100_last3<-graz.100 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% c(118,130,142))
Graz.summ.100 <- summarySE(data=graz100_last3,measurevar='graz',groupvars=c('Strain','Ev','Acc'))
graz50_last3<-graz.50 %>% 
  filter(Strain != 1391) %>% 
  filter(Week %in% c(118,130,142))
Graz.summ.50 <- summarySE(data=graz50_last3,measurevar='graz',groupvars=c('Strain','Ev','Acc'))

# CUE
CUE.summ.100<- summarySE(data=cue.gr.avg.100,measurevar='CUE',groupvars=c('Strain','Ev','Acc'))
CUE.summ.50<- summarySE(data=cue.gr.avg.50,measurevar='CUE',groupvars=c('Strain','Ev','Acc'))

```

T-testing for Fig 3

```{r}
# test the difference between evolved and acclimates with two sample ttests
# 100
ttest.df.100.3 <- growths100_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, Growth.Rate, Growth.Rate.ref,redf,redf.ref,fvfm,fvfm.ref) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24)
ttest.df.100.3$group <- paste(ttest.df.100.3$Strain,ttest.df.100.3$Ev,ttest.df.100.3$Acc,sep='.')
# set up df to save results
pvals.df.100.3 <- as.data.frame(unique(ttest.df.100.3$group))
names(pvals.df.100.3) <- 'group'
pvals.df.100.3$Strain <- ttest.df.100.3$Strain[match(pvals.df.100.3$group,ttest.df.100.3$group)]
pvals.df.100.3$Ev <- ttest.df.100.3$Ev[match(pvals.df.100.3$group,ttest.df.100.3$group)]
pvals.df.100.3$Acc <- ttest.df.100.3$Acc[match(pvals.df.100.3$group,ttest.df.100.3$group)]
pvals.df.100.3$p.value.growth <- NA
pvals.df.100.3$p.value.redf <- NA
pvals.df.100.3$p.value.fvfm <- NA
#GR 2 sample
for(i in 1:dim(pvals.df.100.3)[1]){
  hold1 <-ttest.df.100.3[ttest.df.100.3$group==pvals.df.100.3$group[i],] %>% 
    pull(Growth.Rate)
   hold2 <-ttest.df.100.3[ttest.df.100.3$group==pvals.df.100.3$group[i],] %>% 
    pull(Growth.Rate.ref)
  hold.ttest <- t.test(hold1,hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.3$p.value.growth[i] <- round(tidy.hold$p.value,3) }
# REDF
for(i in 1:dim(pvals.df.100.3)[1]){
  hold1 <-ttest.df.100.3[ttest.df.100.3$group==pvals.df.100.3$group[i],] %>% 
    pull(redf)
  hold2 <-ttest.df.100.3[ttest.df.100.3$group==pvals.df.100.3$group[i],] %>% 
    pull(redf.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.3$p.value.redf[i] <- round(tidy.hold$p.value,3) }
#FVFM
for(i in 1:dim(pvals.df.100.3)[1]){
  hold1 <-ttest.df.100.3[ttest.df.100.3$group==pvals.df.100.3$group[i],] %>% 
    pull(fvfm)
   hold2 <-ttest.df.100.3[ttest.df.100.3$group==pvals.df.100.3$group[i],] %>% 
    pull(fvfm.ref)
   hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.3$p.value.fvfm[i] <- round(tidy.hold$p.value,3) }

## CN 
ttest.df.100.cn <- cn.100_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, C, C.ref, N, N.ref) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24)
ttest.df.100.cn$group <- paste(ttest.df.100.cn$Strain,ttest.df.100.cn$Ev,ttest.df.100.cn$Acc,sep='.')
pvals.df.100.3$p.value.c <- NA
#C
for(i in 1:dim(pvals.df.100.3)[1]){
  hold1 <-ttest.df.100.cn[ttest.df.100.cn$group==pvals.df.100.3$group[i],] %>% 
    pull(C)
  hold2 <-ttest.df.100.cn[ttest.df.100.cn$group==pvals.df.100.3$group[i],] %>% 
    pull(C.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.3$p.value.c[i] <- round(tidy.hold$p.value,3) }

## Respirometry
ttest.df.100.resp <- resp.100_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, Resp, Resp.ref, Photo, Photo.ref) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24) %>% 
  filter(!is.na(Resp.ref))
ttest.df.100.resp$group <- paste(ttest.df.100.resp$Strain,ttest.df.100.resp$Ev,ttest.df.100.resp$Acc,sep='.')
pvals.df.100.3$p.value.resp <- NA
pvals.df.100.3$p.value.photo <- NA
# resp
for(i in 1:dim(pvals.df.100.3)[1]){
  hold1 <-ttest.df.100.resp[ttest.df.100.resp$group==pvals.df.100.3$group[i],] %>% 
    pull(Resp)
  hold2 <-ttest.df.100.resp[ttest.df.100.resp$group==pvals.df.100.3$group[i],] %>% 
    pull(Resp.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.3$p.value.resp[i] <- round(tidy.hold$p.value,3) }
# photo
for(i in 1:dim(pvals.df.100.3)[1]){
  hold1 <-ttest.df.100.resp[ttest.df.100.resp$group==pvals.df.100.3$group[i],] %>% 
    pull(Photo)
  hold2 <-ttest.df.100.resp[ttest.df.100.resp$group==pvals.df.100.3$group[i],] %>% 
    pull(Photo.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.3$p.value.photo[i] <- round(tidy.hold$p.value,3) }

## Grazing
ttest.df.100.graz <- graz100_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, graz, graz.ref) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24) %>% 
  filter(!is.na(graz.ref))
ttest.df.100.graz$group <- paste(ttest.df.100.graz$Strain,ttest.df.100.graz$Ev,ttest.df.100.graz$Acc,sep='.')
pvals.df.100.3$p.value.graz <- NA
# graz
for(i in 1:dim(pvals.df.100.3)[1]){
  hold1 <-ttest.df.100.graz[ttest.df.100.graz$group==pvals.df.100.3$group[i],] %>% 
    pull(graz)
  hold2 <-ttest.df.100.graz[ttest.df.100.graz$group==pvals.df.100.3$group[i],] %>% 
    pull(graz.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.3$p.value.graz[i] <- round(tidy.hold$p.value,3) }

## CUE
CUE100_last3_del<- cue.gr.avg.100 
CUE100_last3_del$Treat.Acc <- paste(CUE100_last3_del$Strain,CUE100_last3_del$Acc,CUE100_last3_del$Rep,sep='.')
CUE100_hold<-cue.gr.avg.100 %>% 
  filter(Ev == 24)
CUE100_hold$Treat.Acc <- paste(CUE100_hold$Strain,CUE100_hold$Acc,CUE100_hold$Rep,sep='.')
CUE100_last3_del$cue.ref <- CUE100_hold$CUE[match(CUE100_last3_del$Treat.Acc,CUE100_hold[CUE100_hold$Ev==24,]$Treat.Acc)] 
CUE100_last3_del <- CUE100_last3_del[!is.na(CUE100_last3_del$cue.ref),]
# Match evolved & ancestral reference points
CUE100_last3_del$cue.propdel <- (CUE100_last3_del$CUE-CUE100_last3_del$cue.ref)/abs(CUE100_last3_del$cue.ref) # Compute rel. difference
CUE100_last3_del$cue.del <- (CUE100_last3_del$CUE-CUE100_last3_del$cue.ref) # Compute abs difference

## CUE
ttest.df.100.cue <- CUE100_last3_del %>%
  select( ID, Strain, Ev, Acc, Rep, CUE, cue.ref) %>%
  filter(Ev==Acc) %>%
  filter(Ev != 24) %>%
  filter(!is.na(cue.ref))
ttest.df.100.cue$group <- paste(ttest.df.100.cue$Strain,ttest.df.100.cue$Ev,ttest.df.100.cue$Acc,sep='.')
pvals.df.100.3$p.value.cue <- NA
# cue
for(i in 1:dim(pvals.df.100.3)[1]){
  hold1 <-ttest.df.100.cue[ttest.df.100.cue$group==pvals.df.100.3$group[i],] %>%
    pull(CUE)
  hold2 <-ttest.df.100.cue[ttest.df.100.cue$group==pvals.df.100.3$group[i],] %>%
    pull(cue.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.3$p.value.cue[i] <- round(tidy.hold$p.value,3) }


## data frame of significance for plotting
pvals.df.100.3.sig <- pvals.df.100.3
pvals.df.100.3.sig[ ,5:12][pvals.df.100.3.sig [,5:12] > .05] <- NA
pvals.df.100.3.sig[ ,5:12][pvals.df.100.3.sig [,5:12] <=.001] <- "high"
pvals.df.100.3.sig[ ,5:12][pvals.df.100.3.sig [,5:12] <=.01] <-"mid"
pvals.df.100.3.sig[ ,5:12][pvals.df.100.3.sig [,5:12] <=.05] <-"low"

pvals.df.100.3.sig[ ,5:12][pvals.df.100.3.sig [,5:12] == "high"] <- "***"
pvals.df.100.3.sig[ ,5:12][pvals.df.100.3.sig [,5:12] =="mid"] <- "**"
pvals.df.100.3.sig[ ,5:12][pvals.df.100.3.sig [,5:12] =="low"] <-  "*"
 
# repeat all for 50
ttest.df.50.3 <- growths50_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, Growth.Rate, Growth.Rate.ref,redf,redf.ref,fvfm,fvfm.ref) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24)
ttest.df.50.3$group <- paste(ttest.df.50.3$Strain,ttest.df.50.3$Ev,ttest.df.50.3$Acc,sep='.')
# df to save results
pvals.df.50.3 <- as.data.frame(unique(ttest.df.50.3$group))
names(pvals.df.50.3) <- 'group'
pvals.df.50.3$Strain <- ttest.df.50.3$Strain[match(pvals.df.50.3$group,ttest.df.50.3$group)]
pvals.df.50.3$Ev <- ttest.df.50.3$Ev[match(pvals.df.50.3$group,ttest.df.50.3$group)]
pvals.df.50.3$Acc <- ttest.df.50.3$Acc[match(pvals.df.50.3$group,ttest.df.50.3$group)]
pvals.df.50.3$p.value.growth <- NA
pvals.df.50.3$p.value.redf <- NA
pvals.df.50.3$p.value.fvfm <- NA
#GR 2 sample
for(i in 1:dim(pvals.df.50.3)[1]){
  hold1 <-ttest.df.50.3[ttest.df.50.3$group==pvals.df.50.3$group[i],] %>% 
    pull(Growth.Rate)
   hold2 <-ttest.df.50.3[ttest.df.50.3$group==pvals.df.50.3$group[i],] %>% 
    pull(Growth.Rate.ref)
  hold.ttest <- t.test(hold1,hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.50.3$p.value.growth[i] <- round(tidy.hold$p.value,3) }
# REDF
for(i in 1:dim(pvals.df.50.3)[1]){
  hold1 <-ttest.df.50.3[ttest.df.50.3$group==pvals.df.50.3$group[i],] %>% 
    pull(redf)
  hold2 <-ttest.df.50.3[ttest.df.50.3$group==pvals.df.50.3$group[i],] %>% 
    pull(redf.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.50.3$p.value.redf[i] <- round(tidy.hold$p.value,3) }
#FVFM
for(i in 1:dim(pvals.df.50.3)[1]){
  hold1 <-ttest.df.50.3[ttest.df.50.3$group==pvals.df.50.3$group[i],] %>% 
    pull(fvfm)
   hold2 <-ttest.df.50.3[ttest.df.50.3$group==pvals.df.50.3$group[i],] %>% 
    pull(fvfm.ref)
   hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.50.3$p.value.fvfm[i] <- round(tidy.hold$p.value,3) }

## CN
ttest.df.50.cn <- cn.50_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, C, C.ref, N, N.ref) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24)
ttest.df.50.cn$group <- paste(ttest.df.50.cn$Strain,ttest.df.50.cn$Ev,ttest.df.50.cn$Acc,sep='.')
pvals.df.50.3$p.value.c <- NA
# C
for(i in 1:dim(pvals.df.50.3)[1]){
  hold1 <-ttest.df.50.cn[ttest.df.50.cn$group==pvals.df.50.3$group[i],] %>% 
    pull(C)
  hold2 <-ttest.df.50.cn[ttest.df.50.cn$group==pvals.df.50.3$group[i],] %>% 
    pull(C.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.50.3$p.value.c[i] <- round(tidy.hold$p.value,3) }

## Respirometry
ttest.df.50.resp <- resp.50_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, Resp, Resp.ref, Photo, Photo.ref) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24) %>% 
  filter(!is.na(Resp.ref))
ttest.df.50.resp$group <- paste(ttest.df.50.resp$Strain,ttest.df.50.resp$Ev,ttest.df.50.resp$Acc,sep='.')
pvals.df.50.3$p.value.resp <- NA
pvals.df.50.3$p.value.photo <- NA
# resp
for(i in 1:dim(pvals.df.50.3)[1]){
  hold1 <-ttest.df.50.resp[ttest.df.50.resp$group==pvals.df.50.3$group[i],] %>% 
    pull(Resp)
  hold2 <-ttest.df.50.resp[ttest.df.50.resp$group==pvals.df.50.3$group[i],] %>% 
    pull(Resp.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.50.3$p.value.resp[i] <- round(tidy.hold$p.value,3) }
# photo
for(i in 1:dim(pvals.df.50.3)[1]){
  hold1 <-ttest.df.50.resp[ttest.df.50.resp$group==pvals.df.50.3$group[i],] %>% 
    pull(Photo)
  hold2 <-ttest.df.50.resp[ttest.df.50.resp$group==pvals.df.50.3$group[i],] %>% 
    pull(Photo.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.50.3$p.value.photo[i] <- round(tidy.hold$p.value,3) }

## Grazing
ttest.df.50.graz <- graz50_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, graz, graz.ref) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24) %>% 
  filter(!is.na(graz.ref))
ttest.df.50.graz$group <- paste(ttest.df.50.graz$Strain,ttest.df.50.graz$Ev,ttest.df.50.graz$Acc,sep='.')
pvals.df.50.3$p.value.graz <- NA
# graz
for(i in 1:dim(pvals.df.50.3)[1]){
  hold1 <-ttest.df.50.graz[ttest.df.50.graz$group==pvals.df.50.3$group[i],] %>% 
    pull(graz)
  hold2 <-ttest.df.50.graz[ttest.df.50.graz$group==pvals.df.50.3$group[i],] %>% 
    pull(graz.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.50.3$p.value.graz[i] <- round(tidy.hold$p.value,3) }

## CUE prep
CUE50_last3_del<- cue.gr.avg.50 
CUE50_last3_del$Treat.Acc <- paste(CUE50_last3_del$Strain,CUE50_last3_del$Acc,CUE50_last3_del$Rep,sep='.')
CUE50_hold<-cue.gr.avg.50 %>% 
  filter(Ev == 24)
CUE50_hold$Treat.Acc <- paste(CUE50_hold$Strain,CUE50_hold$Acc,CUE50_hold$Rep,sep='.')
CUE50_last3_del$cue.ref <- CUE50_hold$CUE[match(CUE50_last3_del$Treat.Acc,CUE50_hold[CUE50_hold$Ev==24,]$Treat.Acc)] 
CUE50_last3_del <- CUE50_last3_del[!is.na(CUE50_last3_del$cue.ref),]
# Match evolved & ancestral reference points
CUE50_last3_del$cue.propdel <- (CUE50_last3_del$CUE-CUE50_last3_del$cue.ref)/abs(CUE50_last3_del$cue.ref) # Compute rel. difference
CUE50_last3_del$cue.del <- (CUE50_last3_del$CUE-CUE50_last3_del$cue.ref) # Compute abs difference
## CUE
ttest.df.50.cue <- CUE50_last3_del %>%
  select( ID, Strain, Ev, Acc, Rep, CUE, cue.ref) %>%
  filter(Ev==Acc) %>%
  filter(Ev != 24) %>%
  filter(!is.na(cue.ref))
ttest.df.50.cue$group <- paste(ttest.df.50.cue$Strain,ttest.df.50.cue$Ev,ttest.df.50.cue$Acc,sep='.')
pvals.df.50.3$p.value.cue <- NA
# cue
for(i in 1:dim(pvals.df.50.3)[1]){
  hold1 <-ttest.df.50.cue[ttest.df.50.cue$group==pvals.df.50.3$group[i],] %>%
    pull(CUE)
  hold2 <-ttest.df.50.cue[ttest.df.50.cue$group==pvals.df.50.3$group[i],] %>%
    pull(cue.ref)
  hold.ttest <- t.test(hold1, hold2)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.50.3$p.value.cue[i] <- round(tidy.hold$p.value,3) }


## data frame of significance
pvals.df.50.3.sig <- pvals.df.50.3
pvals.df.50.3.sig[ ,5:12][pvals.df.50.3.sig [,5:12] > .05] <- NA
pvals.df.50.3.sig[ ,5:12][pvals.df.50.3.sig [,5:12] <=.001] <- "high"
pvals.df.50.3.sig[ ,5:12][pvals.df.50.3.sig [,5:12] <=.01] <-"mid"
pvals.df.50.3.sig[ ,5:12][pvals.df.50.3.sig [,5:12] <=.05] <-"low"

pvals.df.50.3.sig[ ,5:12][pvals.df.50.3.sig [,5:12] == "high"] <- "***"
pvals.df.50.3.sig[ ,5:12][pvals.df.50.3.sig [,5:12] =="mid"] <- "**"
pvals.df.50.3.sig[ ,5:12][pvals.df.50.3.sig [,5:12] =="low"] <-  "*"


```

## save plots for composite figure 3

Plots 100uE 1393

```{r}
theme_set(theme_base(base_size = 10)) 
theme_update(plot.background=element_blank())

#limits
growth.y <- c(0,1)
CUE.y <- c(0, .7)
C.y <- c(0,30)
redf.y <-c(0,1)
phot.y <- c(0,20)
graz.y <- c(0,3)
resp.y <- c(0,60)

labelcex <- 10
sigsize <- 5

#Growth rate of 1393 at 100 by acclimation temperature with experimental lineages in blue and red and control lineages in gray
strainchoice <- 1393
lightchoice <- 100

points.sig <- pvals.df.100.3.sig %>% 
  filter(Strain == strainchoice) 

#cue
a0 <- ggplot(subset(CUE.summ.100, Ev==Acc & Strain == strainchoice), 
             aes(x = Acc, y=CUE, color=as.factor(Ev))) + 
  geom_errorbar(aes(ymin = CUE-se, ymax = CUE+se), width=.2) +
  scale_color_manual(values = newcols) +
  scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(-.3,1.025))+
  theme(legend.position = "none",
  axis.title.x = element_blank(),
  axis.text.x = element_blank(),       
  axis.text.y = element_text(size = labelcex),
  axis.ticks.length = unit(.10, "cm"),
  plot.margin = margin(.1, .1, .1, .5, "cm")) +
  geom_line(color = "black") +
  geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(CUE.summ.100, Ev==24 & Strain == strainchoice), 
                aes(ymin=CUE-se, ymax=CUE+se, width = .2), color = "gray48") +
  geom_line(data = subset(CUE.summ.100, Ev==24 & Strain == strainchoice), 
              color = "gray48", linetype = "dashed") +
  geom_point(data = subset(CUE.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())  +
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.cue, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.cue, color = hcol2,  size = sigsize)

#growth
a1<-ggplot(subset(Growth.summ.100, Ev==Acc & Strain == strainchoice),
           aes(x=Acc, y=Growth.Rate, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se), width=.2) +
    scale_color_manual(values=newcols) +
  scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Growth.summ.100, Ev==24 & Strain == strainchoice), 
                aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se, width = .2), color = "gray48") +
  geom_line(data = subset(Growth.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Growth.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes()) +
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.growth, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5,  label = points.sig[points.sig$Ev==30,]$p.value.growth, color = hcol2, size = sigsize)
 

# Red f 
a2<-ggplot(subset(redf.summ.100, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=redf, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=redf-se, ymax=redf+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(redf.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=redf-se, ymax=redf+se, width = .2), color = "gray48") +
  geom_line(data = subset(redf.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(redf.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes()) +
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.redf, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.redf, color = hcol2, size = sigsize)


# C
a3<-ggplot(subset(C.summ.100, Ev==Acc & Strain == strainchoice), aes(x=Acc, y=C, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=C-se, ymax=C+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(C.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=C-se, ymax=C+se, width = .2), color = "gray48") +
  geom_line(data = subset(C.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(C.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes()) +
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.c, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.c, color = hcol2, size = sigsize)

# Resp
a4 <- ggplot(subset(Resp.summ.100, Ev==Acc & Strain == strainchoice), aes(x=Acc, y=Resp, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Resp-se, ymax=Resp+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
 labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Resp.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=Resp-se, ymax=Resp+se, width = .2), color = "gray48") +
  geom_line(data = subset(Resp.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Resp.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.resp, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.resp, color = hcol2, size = sigsize)

# Photo
a5 <- ggplot(subset(Photo.summ.100, Ev==Acc & Strain == strainchoice), aes(x=Acc, y=Photo, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Photo-se, ymax=Photo+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
 theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Photo.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=Photo-se, ymax=Photo+se, width = .2), color = "gray48") +
  geom_line(data = subset(Photo.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Photo.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.photo, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.photo, color = hcol2, size = sigsize)

# Graz
a6 <- ggplot(subset(Graz.summ.100, Ev==Acc & Strain == strainchoice), aes(x=Acc, y=graz, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=graz-se, ymax=graz+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
 labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Graz.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=graz-se, ymax=graz+se, width = .2), color = "gray48") +
  geom_line(data = subset(Graz.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Graz.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.graz, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.graz, color = hcol2, size = sigsize)

# fvfm
a7<-ggplot(subset(fvfm.summ.100, Ev==Acc & Strain == strainchoice), aes(x=Acc, y=fvfm, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=fvfm-se, ymax=fvfm+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(fvfm.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=fvfm-se, ymax=fvfm+se, width = .2), color = "gray48") +
  geom_line(data = subset(fvfm.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(fvfm.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.fvfm, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.fvfm, color = hcol2, size = sigsize)

# N
a8<-ggplot(subset(N.summ.100.2, Ev==Acc & Strain == strainchoice), aes(x=Acc, y=N, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=N-se, ymax=N+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm") ) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(N.summ.100.2, Ev==24 & Strain == strainchoice),aes(ymin=N-se, ymax=N+se, width = .2), color = "gray48") +
  geom_line(data = subset(N.summ.100.2, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(N.summ.100.2, Ev==24 & Strain == strainchoice), color = "gray48", aes()) 


```

Plots 2951 at 100

```{r}
settheme <- theme_set(theme_base(base_size = 10)) +
  theme_update(plot.background=element_blank())

theme_set(settheme)


#Growth rate of 2951 at 100 by acclimation temperature with experimental lineages in blue and red and control lineages in gray
strainchoice <- 2951
lightchoice <- 100

points.sig <- pvals.df.100.3.sig %>% 
  filter(Strain == strainchoice) 

#cue
b0 <- ggplot(subset(CUE.summ.100, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=CUE, color=as.factor(Ev))) + 
  geom_errorbar(aes(ymin=CUE-se, ymax=CUE+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
   scale_y_continuous(limits = c(.75,.98))+
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(CUE.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=CUE-se, ymax=CUE+se, width = .2), color = "gray48") +
  geom_line(data = subset(CUE.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(CUE.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21, y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.cue, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.cue, color = hcol2, size = sigsize)

#growth
b1<-ggplot(subset(Growth.summ.100, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=Growth.Rate, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se), width=.2) +
    scale_color_manual(values=newcols) +
  scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
 theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Growth.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se, width = .2), color = "gray48") +
  geom_line(data = subset(Growth.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Growth.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.growth, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.growth, color = hcol2, size = sigsize)
 

# Red f 
b2<-ggplot(subset(redf.summ.100, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=redf, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=redf-se, ymax=redf+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(redf.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=redf-se, ymax=redf+se, width = .2), color = "gray48") +
  geom_line(data = subset(redf.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(redf.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21, y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.redf, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.redf, color = hcol2, size = sigsize)


# C
b3<-ggplot(subset(C.summ.100, Ev==Acc & Strain == strainchoice), aes(x=Acc, y=C, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=C-se, ymax=C+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(C.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=C-se, ymax=C+se, width = .2), color = "gray48") +
  geom_line(data = subset(C.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(C.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.c, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.c, color = hcol2, size = sigsize)

# Resp
b4 <- ggplot(subset(Resp.summ.100, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=Resp, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Resp-se, ymax=Resp+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
 theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),      
      plot.margin = margin(.1, .1, .1, .5, "cm") ) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Resp.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=Resp-se, ymax=Resp+se, width = .2), color = "gray48") +
  geom_line(data = subset(Resp.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Resp.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.resp, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.resp, color = hcol2, size = sigsize)

# Photo
b5 <- ggplot(subset(Photo.summ.100, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=Photo, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Photo-se, ymax=Photo+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Photo.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=Photo-se, ymax=Photo+se, width = .2), color = "gray48") +
  geom_line(data = subset(Photo.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Photo.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.photo, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.photo, color = hcol2, size = sigsize)

# Graz
b6 <- ggplot(subset(Graz.summ.100, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=graz, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=graz-se, ymax=graz+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
 theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Graz.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=graz-se, ymax=graz+se, width = .2), color = "gray48") +
  geom_line(data = subset(Graz.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Graz.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.graz, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.graz, color = hcol2, size = sigsize)

# fvfm
b7<-ggplot(subset(fvfm.summ.100, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=fvfm, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=fvfm-se, ymax=fvfm+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm") ) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
 labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(fvfm.summ.100, Ev==24 & Strain == strainchoice),
                aes(ymin=fvfm-se, ymax=fvfm+se, width = .2), color = "gray48") +
  geom_line(data = subset(fvfm.summ.100, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(fvfm.summ.100, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.fvfm, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.fvfm, color = hcol2, size = sigsize)

# N
b8<-ggplot(subset(N.summ.100.2, Ev==Acc & Strain == strainchoice), aes(x=Acc, y=N, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=N-se, ymax=N+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm") ) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(N.summ.100.2, Ev==24 & Strain == strainchoice),aes(ymin=N-se, ymax=N+se, width = .2), color = "gray48") +
  geom_line(data = subset(N.summ.100.2, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(N.summ.100.2, Ev==24 & Strain == strainchoice), color = "gray48", aes())

```

Plots 1393 at 50 

```{r}
theme_set(theme_base(base_size = 10)) 
# theme_update(plot.background=element_blank(),
#              axis.title.y=element_blank(),
#              axis.text.y=element_blank())



#Growth rate of 1393 at 50 by acclimation temperature with experimental lineages in blue and red and control lineages in gray
strainchoice <- 1393
lightchoice <- 50

points.sig <- pvals.df.50.3.sig %>% 
  filter(Strain == strainchoice) 

#CUE
c0 <- ggplot(subset(CUE.summ.50, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=CUE, color=as.factor(Ev))) + 
  geom_errorbar(aes(ymin=CUE-se, ymax=CUE+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(.8,.9))+
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm") ) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
 labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(CUE.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=CUE-se, ymax=CUE+se, width = .2), color = "gray48") +
  geom_line(data = subset(CUE.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(CUE.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.cue, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.cue, color = hcol2, size = sigsize)

#growth
c1<-ggplot(subset(Growth.summ.50, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=Growth.Rate, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se), width=.2) +
    scale_color_manual(values=newcols) +
  scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
 labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Growth.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se, width = .2), color = "gray48") +
  geom_line(data = subset(Growth.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Growth.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.growth, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.growth, color = hcol2, size = sigsize)
 

# Red f 
c2<-ggplot(subset(redf.summ.50, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=redf, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=redf-se, ymax=redf+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
 theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),      
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
 labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(redf.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=redf-se, ymax=redf+se, width = .2), color = "gray48") +
  geom_line(data = subset(redf.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(redf.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.redf, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.redf, color = hcol2, size = sigsize)


# C
c3<-ggplot(subset(C.summ.50, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=C, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=C-se, ymax=C+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
 theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),      
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(C.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=C-se, ymax=C+se, width = .2), color = "gray48") +
  geom_line(data = subset(C.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(C.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.c, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.c, color = hcol2, size = sigsize)

# Resp
c4 <- ggplot(subset(Resp.summ.50, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=Resp, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Resp-se, ymax=Resp+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
      axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")  ) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Resp.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=Resp-se, ymax=Resp+se, width = .2), color = "gray48") +
  geom_line(data = subset(Resp.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Resp.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.resp, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.resp, color = hcol2, size = sigsize)

# Photo
c5 <- ggplot(subset(Photo.summ.50, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=Photo, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Photo-se, ymax=Photo+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Photo.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=Photo-se, ymax=Photo+se, width = .2), color = "gray48") +
  geom_line(data = subset(Photo.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Photo.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21, y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.photo, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.photo, color = hcol2, size = sigsize)

# Graz
c6 <- ggplot(subset(Graz.summ.50, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=graz, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=graz-se, ymax=graz+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
 theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),      
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Graz.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=graz-se, ymax=graz+se, width = .2), color = "gray48") +
  geom_line(data = subset(Graz.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Graz.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.graz, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.graz, color = hcol2, size = sigsize)

# fvfm
c7<-ggplot(subset(fvfm.summ.50, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=fvfm, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=fvfm-se, ymax=fvfm+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm") ) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(fvfm.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=fvfm-se, ymax=fvfm+se, width = .2), color = "gray48") +
  geom_line(data = subset(fvfm.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(fvfm.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.fvfm, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.fvfm, color = hcol2, size = sigsize)

# N
c8<-ggplot(subset(N.summ.100.2, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=N, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=N-se, ymax=N+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),      
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(N.summ.100.2, Ev==24 & Strain == strainchoice),
                aes(ymin=N-se, ymax=N+se, width = .2), color = "gray48") +
  geom_line(data = subset(N.summ.100.2, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(N.summ.100.2, Ev==24 & Strain == strainchoice), color = "gray48", aes())


```

Plots 2951 at 50

```{r}

#Growth rate of 2951 at 50 by acclimation temperature with experimental lineages in blue and red and control lineages in gray
strainchoice <- 2951
lightchoice <- 50

points.sig <- pvals.df.50.3.sig %>% 
  filter(Strain == strainchoice) 

#cue
d0 <- ggplot(subset(CUE.summ.50, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=CUE, color=as.factor(Ev))) + 
  geom_errorbar(aes(ymin=CUE-se, ymax=CUE+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),      
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(CUE.summ.50, Ev==24 & Strain == strainchoice),aes(ymin=CUE-se, ymax=CUE+se, width = .2), color = "gray48") +
  geom_line(data = subset(CUE.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(CUE.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.cue, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.cue, color = hcol2, size = sigsize)

#growth
d1<-ggplot(subset(Growth.summ.50, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=Growth.Rate, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se), width=.2) +
    scale_color_manual(values=newcols) +
  scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
 theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm") ) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
 labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Growth.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se, width = .2), color = "gray48") +
  geom_line(data = subset(Growth.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Growth.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.growth, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.growth, color = hcol2, size = sigsize)
 

# Red f 
d2<-ggplot(subset(redf.summ.50, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=redf, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=redf-se, ymax=redf+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
 labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(redf.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=redf-se, ymax=redf+se, width = .2), color = "gray48") +
  geom_line(data = subset(redf.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(redf.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.redf, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.redf, color = hcol2, size = sigsize)


# C
d3<-ggplot(subset(C.summ.50, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=C, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=C-se, ymax=C+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(C.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=C-se, ymax=C+se, width = .2), color = "gray48") +
  geom_line(data = subset(C.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(C.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.c, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.c, color = hcol2, size = sigsize)

# Resp
d4 <- ggplot(subset(Resp.summ.50, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=Resp, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Resp-se, ymax=Resp+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
   theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Resp.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=Resp-se, ymax=Resp+se, width = .2), color = "gray48") +
  geom_line(data = subset(Resp.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Resp.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.resp, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.resp, color = hcol2, size = sigsize)

# Photo
d5 <- ggplot(subset(Photo.summ.50, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=Photo, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Photo-se, ymax=Photo+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Photo.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=Photo-se, ymax=Photo+se, width = .2), color = "gray48") +
  geom_line(data = subset(Photo.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Photo.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.photo, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.photo, color = hcol2, size = sigsize)

# Graz
d6 <- ggplot(subset(Graz.summ.50, Ev==Acc & Strain == strainchoice), 
             aes(x=Acc, y=graz, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=graz-se, ymax=graz+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(Graz.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=graz-se, ymax=graz+se, width = .2), color = "gray48") +
  geom_line(data = subset(Graz.summ.50, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(Graz.summ.50, Ev==24 & Strain == strainchoice), color = "gray48", aes())+
  annotate("text", x= 21, y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.graz, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.graz, color = hcol2, size = sigsize)


# fvfm
d7<-ggplot(subset(fvfm.summ.50, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=fvfm, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=fvfm-se, ymax=fvfm+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
 theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       
      plot.margin = margin(.1, .1, .1, .5, "cm")) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
  labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(fvfm.summ.50, Ev==24 & Strain == strainchoice),
                aes(ymin=fvfm-se, ymax=fvfm+se, width = .2), color = "gray48") +
  geom_line(data = subset(fvfm.summ.50, Ev==24 &Strain == strainchoice), 
            color = "gray48", linetype = "dashed") +
  geom_point(data = subset(fvfm.summ.50, Ev==24 & Strain == strainchoice), 
             color = "gray48", aes())+
  annotate("text", x= 21,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==18,]$p.value.fvfm, color = lcol2, size = sigsize) +
  annotate("text", x= 27,  y = Inf, vjust = 1.5, label = points.sig[points.sig$Ev==30,]$p.value.fvfm, color = hcol2, size = sigsize)

# N
d8<-ggplot(subset(N.summ.100.2, Ev==Acc & Strain == strainchoice), 
           aes(x=Acc, y=N, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=N-se, ymax=N+se), width=.2) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
theme(legend.position = "none",
      axis.title.x=element_blank(),
      axis.text.x=element_blank(),       
      axis.text.y=element_text(size = labelcex),
       axis.ticks.length = unit(.10, "cm"),       plot.margin = margin(.1, .1, .1, .5, "cm")
      ) +
    geom_line(color = "black") +
    geom_point(size=3, aes()) +
labs( y = NULL, x=NULL) +
  geom_errorbar(data = subset(N.summ.100.2, Ev==24 & Strain == strainchoice),aes(ymin=N-se, ymax=N+se, width = .2), color = "gray48") +
  geom_line(data = subset(N.summ.100.2, Ev==24 &Strain == strainchoice), color = "gray48", linetype = "dashed") +
  geom_point(data = subset(N.summ.100.2, Ev==24 & Strain == strainchoice), color = "gray48", aes())


```

Arrange all plots

```{r, fig.height=4.5, fig.width=4}

theme_set(theme_base(base_size = 10)) 
theme_update(plot.background=element_blank())
 
# 1 growth rate
# 3 c cell
# 0 cue
# 4 resp
# 5 photo
# 6 graz
# 2 chla
# 7 fvfm
#8 N


labelcex <- 10

ggarrange(a1, c1, b1,  d1,
          a3, c3, b3, d3,
          a5, c5, b5, d5,
          a6,c6,b6,d6,
          a4, c4, b4,  d4,
          a0,c0,b0,d0,
          labels = c("A", "B", "C","D",
                     "E","F","G","H",
                     "I","J","K","L",
                     "M","N","O","P",
                     "Q","R","S","T",
                     "U","V","W","X"),
          font.label = list(size = 12, color = "black", family = NULL),
          label.x = 0,
          label.y = 1,
          ncol = 4, nrow = 6, align="hv"  )

# Figure S3
ggarrange(a2, c2, b2,d2,
  a7, c7, b7,d7,
   labels = c("A", "B", "C","D",
                     "E","F","G","H"),
   font.label = list(size = 12, color = "black", family = NULL),
          label.x = 0,
          label.y = 1,
          ncol = 4, nrow = 6, align="hv" )

```

### 1393 bar graphs of deltas


```{r}
# TTEST FOR LOOP for deltas compared to 0
ttest.df.100.2 <- growths100_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, Growth.del, redf.del, fvfm.del) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24)
ttest.df.100.2$group <- paste(ttest.df.100.2$Strain,ttest.df.100.2$Ev,ttest.df.100.2$Acc,sep='.')

pvals.df.100.2 <- as.data.frame(unique(ttest.df.100.2$group))
names(pvals.df.100.2) <- 'group'
pvals.df.100.2$Strain <- ttest.df.100.2$Strain[match(pvals.df.100.2$group,ttest.df.100.2$group)]
pvals.df.100.2$Ev <- ttest.df.100.2$Ev[match(pvals.df.100.2$group,ttest.df.100.2$group)]
pvals.df.100.2$Acc <- ttest.df.100.2$Acc[match(pvals.df.100.2$group,ttest.df.100.2$group)]
pvals.df.100.2$p.value.growth <- NA
pvals.df.100.2$p.value.redf <- NA
pvals.df.100.2$p.value.fvfm <- NA
#GR
for(i in 1:dim(pvals.df.100.2)[1]){
  hold <-ttest.df.100.2[ttest.df.100.2$group==pvals.df.100.2$group[i],] %>% 
    pull(Growth.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.2$p.value.growth[i] <- round(tidy.hold$p.value,3) }
# REDF
for(i in 1:dim(pvals.df.100.2)[1]){
  hold <-ttest.df.100.2[ttest.df.100.2$group==pvals.df.100.2$group[i],] %>% 
    pull(redf.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.2$p.value.redf[i] <- round(tidy.hold$p.value,3) }
#FVFM
for(i in 1:dim(pvals.df.100.2)[1]){
  hold <-ttest.df.100.2[ttest.df.100.2$group==pvals.df.100.2$group[i],] %>% 
    pull(fvfm.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.2$p.value.fvfm[i] <- round(tidy.hold$p.value,3) }

## CN
ttest.df.100.cn <- cn.100_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, C.del, N.del) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24)
ttest.df.100.cn$group <- paste(ttest.df.100.cn$Strain,ttest.df.100.cn$Ev,ttest.df.100.cn$Acc,sep='.')
pvals.df.100.2$p.value.c <- NA
# C
for(i in 1:dim(pvals.df.100.2)[1]){
  hold <-ttest.df.100.cn[ttest.df.100.cn$group==pvals.df.100.2$group[i],] %>% 
    pull(C.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.2$p.value.c[i] <- round(tidy.hold$p.value,3) }

## Resp
ttest.df.100.resp <- resp.100_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, Resp.del, Photo.del) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24) %>% 
  filter(!is.na(Resp.del))
ttest.df.100.resp$group <- paste(ttest.df.100.resp$Strain,ttest.df.100.resp$Ev,ttest.df.100.resp$Acc,sep='.')
pvals.df.100.2$p.value.resp <- NA
pvals.df.100.2$p.value.photo <- NA
# resp
for(i in 1:dim(pvals.df.100.2)[1]){
  hold <-ttest.df.100.resp[ttest.df.100.resp$group==pvals.df.100.2$group[i],] %>% 
    pull(Resp.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.2$p.value.resp[i] <- round(tidy.hold$p.value,3) }
# photo
for(i in 1:dim(pvals.df.100.2)[1]){
  hold <-ttest.df.100.resp[ttest.df.100.resp$group==pvals.df.100.2$group[i],] %>% 
    pull(Photo.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.2$p.value.photo[i] <- round(tidy.hold$p.value,3) }

## Graz
ttest.df.100.graz <- graz100_last3 %>% 
  filter(Strain != 1391) %>% 
  select( ID, Strain, Ev, Acc, Rep, Week, Grazing.del) %>% 
  filter(Ev==Acc) %>% 
  filter(Ev != 24) %>% 
  filter(!is.na(Grazing.del))
ttest.df.100.graz$group <- paste(ttest.df.100.graz$Strain,ttest.df.100.graz$Ev,ttest.df.100.graz$Acc,sep='.')
pvals.df.100.2$p.value.graz <- NA

# graz
for(i in 1:dim(pvals.df.100.2)[1]){
  hold <-ttest.df.100.graz[ttest.df.100.graz$group==pvals.df.100.2$group[i],] %>% 
    pull(Grazing.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.2$p.value.graz[i] <- round(tidy.hold$p.value,3) }

## CUE

CUE100_last3_del<- cue.gr.avg.100 
CUE100_last3_del$Treat.Acc <- paste(CUE100_last3_del$Strain,CUE100_last3_del$Acc,CUE100_last3_del$Rep,sep='.')

CUE100_hold<-cue.gr.avg.100 %>% 
  filter(Ev == 24)
CUE100_hold$Treat.Acc <- paste(CUE100_hold$Strain,CUE100_hold$Acc,CUE100_hold$Rep,sep='.')

CUE100_last3_del$cue.ref <- CUE100_hold$CUE[match(CUE100_last3_del$Treat.Acc,CUE100_hold[CUE100_hold$Ev==24,]$Treat.Acc)] 

CUE100_last3_del <- CUE100_last3_del[!is.na(CUE100_last3_del$cue.ref),]

# Match evolved & ancestral reference points
CUE100_last3_del$cue.propdel <- (CUE100_last3_del$CUE-CUE100_last3_del$cue.ref)/abs(CUE100_last3_del$cue.ref) # Compute rel. difference
CUE100_last3_del$cue.del <- (CUE100_last3_del$CUE-CUE100_last3_del$cue.ref) # Compute abs difference

## CUE
ttest.df.100.cue <- CUE100_last3_del %>%
  select( ID, Strain, Ev, Acc, Rep, cue.del) %>%
  filter(Ev==Acc) %>%
  filter(Ev != 24) %>%
  filter(!is.na(cue.del))
ttest.df.100.cue$group <- paste(ttest.df.100.cue$Strain,ttest.df.100.cue$Ev,ttest.df.100.cue$Acc,sep='.')
pvals.df.100.2$p.value.cue <- NA

# cue
for(i in 1:dim(pvals.df.100.2)[1]){
  hold <-ttest.df.100.cue[ttest.df.100.cue$group==pvals.df.100.2$group[i],] %>%
    pull(cue.del)
  hold.ttest <- t.test(hold)
  tidy.hold <- tidy(hold.ttest)
  pvals.df.100.2$p.value.cue[i] <- round(tidy.hold$p.value,3) }


## data frame of significance

pvals.df.100.2.sig <- pvals.df.100.2
pvals.df.100.2.sig[ ,5:12][pvals.df.100.2.sig [,5:12] > .05] <- NA
pvals.df.100.2.sig[ ,5:12][pvals.df.100.2.sig [,5:12] <=.001] <- "high"
pvals.df.100.2.sig[ ,5:12][pvals.df.100.2.sig [,5:12] <=.01] <-"mid"
pvals.df.100.2.sig[ ,5:12][pvals.df.100.2.sig [,5:12] <=.05] <-"low"

pvals.df.100.2.sig[ ,5:12][pvals.df.100.2.sig [,5:12] == "high"] <- "***"
pvals.df.100.2.sig[ ,5:12][pvals.df.100.2.sig [,5:12] =="mid"] <- "**"
pvals.df.100.2.sig[ ,5:12][pvals.df.100.2.sig [,5:12] =="low"] <-  "*"
 

# ## repeat for 50 
# 
# # TTEST FOR LOOP
# ttest.df.50.2 <- growths50_last3 %>% 
#   filter(Strain != 1391) %>% 
#   select( ID, Strain, Ev, Acc, Rep, Week, Growth.del, redf.del, fvfm.del) %>% 
#   filter(Ev==Acc) %>% 
#   filter(Ev != 24)
# ttest.df.50.2$group <- paste(ttest.df.50.2$Strain,ttest.df.50.2$Ev,ttest.df.50.2$Acc,sep='.')
# 
# pvals.df.50.2 <- as.data.frame(unique(ttest.df.50.2$group))
# names(pvals.df.50.2) <- 'group'
# pvals.df.50.2$Strain <- ttest.df.50.2$Strain[match(pvals.df.50.2$group,ttest.df.50.2$group)]
# pvals.df.50.2$Ev <- ttest.df.50.2$Ev[match(pvals.df.50.2$group,ttest.df.50.2$group)]
# pvals.df.50.2$Acc <- ttest.df.50.2$Acc[match(pvals.df.50.2$group,ttest.df.50.2$group)]
# pvals.df.50.2$p.value.growth <- NA
# pvals.df.50.2$p.value.redf <- NA
# pvals.df.50.2$p.value.fvfm <- NA
# #GR
# for(i in 1:dim(pvals.df.50.2)[1]){
#   hold <-ttest.df.50.2[ttest.df.50.2$group==pvals.df.50.2$group[i],] %>% 
#     pull(Growth.del)
#   hold.ttest <- t.test(hold)
#   tidy.hold <- tidy(hold.ttest)
#   pvals.df.50.2$p.value.growth[i] <- round(tidy.hold$p.value,3) }
# # REDF
# for(i in 1:dim(pvals.df.50.2)[1]){
#   hold <-ttest.df.50.2[ttest.df.50.2$group==pvals.df.50.2$group[i],] %>% 
#     pull(redf.del)
#   hold.ttest <- t.test(hold)
#   tidy.hold <- tidy(hold.ttest)
#   pvals.df.50.2$p.value.redf[i] <- round(tidy.hold$p.value,3) }
# #FVFM
# for(i in 1:dim(pvals.df.50.2)[1]){
#   hold <-ttest.df.50.2[ttest.df.50.2$group==pvals.df.50.2$group[i],] %>% 
#     pull(fvfm.del)
#   hold.ttest <- t.test(hold)
#   tidy.hold <- tidy(hold.ttest)
#   pvals.df.50.2$p.value.fvfm[i] <- round(tidy.hold$p.value,3) }
# 
# ## CN
# ttest.df.50.cn <- cn.50_last3 %>% 
#   filter(Strain != 1391) %>% 
#   select( ID, Strain, Ev, Acc, Rep, Week, C.del, N.del) %>% 
#   filter(Ev==Acc) %>% 
#   filter(Ev != 24)
# ttest.df.50.cn$group <- paste(ttest.df.50.cn$Strain,ttest.df.50.cn$Ev,ttest.df.50.cn$Acc,sep='.')
# pvals.df.50.2$p.value.c <- NA
# # C
# for(i in 1:dim(pvals.df.50.2)[1]){
#   hold <-ttest.df.50.cn[ttest.df.50.cn$group==pvals.df.50.2$group[i],] %>% 
#     pull(C.del)
#   hold.ttest <- t.test(hold)
#   tidy.hold <- tidy(hold.ttest)
#   pvals.df.50.2$p.value.c[i] <- round(tidy.hold$p.value,3) }
# 
# ## Resp
# ttest.df.50.resp <- resp.50_last3 %>% 
#   filter(Strain != 1391) %>% 
#   select( ID, Strain, Ev, Acc, Rep, Week, Resp.del, Photo.del) %>% 
#   filter(Ev==Acc) %>% 
#   filter(Ev != 24) %>% 
#   filter(!is.na(Resp.del))
# ttest.df.50.resp$group <- paste(ttest.df.50.resp$Strain,ttest.df.50.resp$Ev,ttest.df.50.resp$Acc,sep='.')
# pvals.df.50.2$p.value.resp <- NA
# pvals.df.50.2$p.value.photo <- NA
# # resp
# for(i in 1:dim(pvals.df.50.2)[1]){
#   hold <-ttest.df.50.resp[ttest.df.50.resp$group==pvals.df.50.2$group[i],] %>% 
#     pull(Resp.del)
#   hold.ttest <- t.test(hold)
#   tidy.hold <- tidy(hold.ttest)
#   pvals.df.50.2$p.value.resp[i] <- round(tidy.hold$p.value,3) }
# # photo
# for(i in 1:dim(pvals.df.50.2)[1]){
#   hold <-ttest.df.50.resp[ttest.df.50.resp$group==pvals.df.50.2$group[i],] %>% 
#     pull(Photo.del)
#   hold.ttest <- t.test(hold)
#   tidy.hold <- tidy(hold.ttest)
#   pvals.df.50.2$p.value.photo[i] <- round(tidy.hold$p.value,3) }
# 
# ## Graz
# ttest.df.50.graz <- graz50_last3 %>% 
#   filter(Strain != 1391) %>% 
#   select( ID, Strain, Ev, Acc, Rep, Week, Grazing.del) %>% 
#   filter(Ev==Acc) %>% 
#   filter(Ev != 24) %>% 
#   filter(!is.na(Grazing.del))
# ttest.df.50.graz$group <- paste(ttest.df.50.graz$Strain,ttest.df.50.graz$Ev,ttest.df.50.graz$Acc,sep='.')
# pvals.df.50.2$p.value.graz <- NA
# 
# # graz
# for(i in 1:dim(pvals.df.50.2)[1]){
#   hold <-ttest.df.50.graz[ttest.df.50.graz$group==pvals.df.50.2$group[i],] %>% 
#     pull(Grazing.del)
#   hold.ttest <- t.test(hold)
#   tidy.hold <- tidy(hold.ttest)
#   pvals.df.50.2$p.value.graz[i] <- round(tidy.hold$p.value,3) }
# 
# ## CUE
# 
# CUE50_last3_del<- cue.gr.avg.50 
# CUE50_last3_del$Treat.Acc <- paste(CUE50_last3_del$Strain,CUE50_last3_del$Acc,CUE50_last3_del$Rep,sep='.')
# 
# CUE50_hold<-cue.gr.avg.50 %>% 
#   filter(Ev == 24)
# CUE50_hold$Treat.Acc <- paste(CUE50_hold$Strain,CUE50_hold$Acc,CUE50_hold$Rep,sep='.')
# 
# CUE50_last3_del$cue.ref <- CUE50_hold$CUE[match(CUE50_last3_del$Treat.Acc,CUE50_hold[CUE50_hold$Ev==24,]$Treat.Acc)] 
# 
# CUE50_last3_del <- CUE50_last3_del[!is.na(CUE50_last3_del$cue.ref),]
# 
# # Match evolved & ancestral reference points
# CUE50_last3_del$cue.propdel <- (CUE50_last3_del$CUE-CUE50_last3_del$cue.ref)/abs(CUE50_last3_del$cue.ref) # Compute rel. difference
# CUE50_last3_del$cue.del <- (CUE50_last3_del$CUE-CUE50_last3_del$cue.ref) # Compute abs difference
# 
# ## CUE
# ttest.df.50.cue <- CUE50_last3_del %>%
#   select( ID, Strain, Ev, Acc, Rep, cue.del) %>%
#   filter(Ev==Acc) %>%
#   filter(Ev != 24) %>%
#   filter(!is.na(cue.del))
# ttest.df.50.cue$group <- paste(ttest.df.50.cue$Strain,ttest.df.50.cue$Ev,ttest.df.50.cue$Acc,sep='.')
# pvals.df.50.2$p.value.cue <- NA
# 
# # cue
# for(i in 1:dim(pvals.df.50.2)[1]){
#   hold <-ttest.df.50.cue[ttest.df.50.cue$group==pvals.df.50.2$group[i],] %>%
#     pull(cue.del)
#   hold.ttest <- t.test(hold)
#   tidy.hold <- tidy(hold.ttest)
#   pvals.df.50.2$p.value.cue[i] <- round(tidy.hold$p.value,3) }
# 
# 
# 
# ## data frame of significance
# 
# pvals.df.50.2.sig <- pvals.df.50.2
# pvals.df.50.2.sig[ ,5:12][pvals.df.50.2.sig [,5:12] > .05] <- NA
# pvals.df.50.2.sig[ ,5:12][pvals.df.50.2.sig [,5:12] <=.001] <- "high"
# pvals.df.50.2.sig[ ,5:12][pvals.df.50.2.sig [,5:12] <=.01] <-"mid"
# pvals.df.50.2.sig[ ,5:12][pvals.df.50.2.sig [,5:12] <=.05] <-"low"
# 
# pvals.df.50.2.sig[ ,5:12][pvals.df.50.2.sig [,5:12] == "high"] <- "***"
# pvals.df.50.2.sig[ ,5:12][pvals.df.50.2.sig [,5:12] =="mid"] <- "**"
# pvals.df.50.2.sig[ ,5:12][pvals.df.50.2.sig [,5:12] =="low"] <-  "*"
 

```
 
 Save plots for bar plot and plot composite fig 4
 
```{r, fig.height=2, fig.width=4}
#Growth, C/cell, Chla, ETR, Cfix, Graz, Resp
theme_set(theme_base(base_size = 10)) 
theme_update(plot.background=element_blank())
# DIFFERENCES

par(mar=c(2,4,2,2),mfcol=c(3,3))
coldhot <- c(lcol,hcol)

growths100_last3.93<-growths100_last3 %>% 
  filter(Strain == 1393) %>% 
  filter(Ev != 24) %>% 
  filter(Acc != 24) %>% 
  filter(Ev == Acc) 
growths100_last3.93$group <- paste(growths100_last3.93$Strain, growths100_last3.93$Ev,sep=".")
cn.100.93<-cn.100 %>% 
  filter(Strain == 1393) %>% 
  filter(Ev != 24) %>% 
  filter(Acc != 24) %>% 
  filter(Ev == Acc) 
cn.100.93$group <- paste(cn.100.93$Strain, cn.100.93$Ev,sep=".")
redf.100_last3.93<-growths100_last3.93 %>% 
  filter(Strain == 1393) %>% 
  filter(Ev != 24) %>% 
  filter(Acc != 24) %>% 
  filter(Ev == Acc) 
redf.100_last3.93$group <- paste(redf.100_last3.93$Strain, redf.100_last3.93$Ev,sep=".")
photopt.100_last3.93<-resp.100_last3%>% 
  filter(Strain == 1393) %>% 
  filter(Ev != 24) %>% 
  filter(Acc != 24) %>% 
  filter(Ev == Acc) %>% 
  filter(!is.na(Photo.del))
photopt.100_last3.93$group <- paste(photopt.100_last3.93$Strain, photopt.100_last3.93$Ev,sep=".")
graz100_last3.93<-graz100_last3%>% 
  filter(Strain == 1393) %>% 
  filter(Ev != 24) %>% 
  filter(Acc != 24) %>% 
  filter(Ev == Acc) 
graz100_last3.93$group <- paste(graz100_last3.93$Strain, graz100_last3.93$Ev,sep=".")
resp.100_last3.93<-resp.100_last3%>% 
  filter(Strain == 1393) %>% 
  filter(Ev != 24) %>% 
  filter(Acc != 24) %>% 
  filter(Ev == Acc) %>% 
  filter(!is.na(Resp.del))
resp.100_last3.93$group <- paste(resp.100_last3.93$Strain, resp.100_last3.93$Ev,sep=".")

growths.93del <- summarySE(data=growths100_last3.93,measurevar='Growth.del',groupvars=c('Strain','Ev','Acc'))
c.93del <- summarySE(data=cn.100.93,measurevar='C.del',groupvars=c('Strain','Ev','Acc'))
redf.93del <- summarySE(data=redf.100_last3.93,measurevar='redf.del',groupvars=c('Strain','Ev','Acc'))
photopt.93del <- summarySE(data=photopt.100_last3.93,measurevar='Photo.del',groupvars=c('Strain','Ev','Acc'))
graz.93del <- summarySE(data=graz100_last3.93,measurevar='Grazing.del',groupvars=c('Strain','Ev','Acc'))
resp.93del <- summarySE(data=resp.100_last3.93,measurevar='Resp.del',groupvars=c('Strain','Ev','Acc'))

#pvalues
bar.pvals <- pvals.df.100.2 %>% 
  filter(Strain == "1393") %>% 
  select( "group", "Ev", "p.value.growth", "p.value.redf","p.value.c", "p.value.resp", "p.value.photo", "p.value.graz")
bar.pvals.sig <- bar.pvals
bar.pvals.sig[ ,3:8][bar.pvals.sig [,3:8] >.05] <- NA

bar.pvals.sig[ ,3:8][bar.pvals.sig [,3:8] <=.001] <- "high"
bar.pvals.sig[ ,3:8][bar.pvals.sig [,3:8] <=.01] <-"mid"
bar.pvals.sig[ ,3:8][bar.pvals.sig [,3:8] <=.05] <-"low"

bar.pvals.sig[ ,3:8][bar.pvals.sig [,3:8] == "high"] <-"***"
bar.pvals.sig[ ,3:8][bar.pvals.sig [,3:8] == "mid"]<-"**"
bar.pvals.sig[ ,3:8][bar.pvals.sig [,3:8] == "low"]<-"*"


labelcex <- 10

p1<-  ggplot(growths.93del, aes(x=as.factor(Ev), y=Growth.del, fill=as.factor(Ev))) + 
  geom_bar(stat="identity")  +
  geom_errorbar(aes(ymin=Growth.del-se, ymax=Growth.del+se), width=.2) +
  scale_fill_manual(values=coldhot) +
  theme(legend.position = "none",
        axis.text.x = element_blank(),
         axis.text.y=element_text(size = labelcex),
        axis.ticks.length = unit(.1, "cm"),
        plot.margin = margin(.1, .1, .1, 1.5, "cm")) +
  labs( y = NULL, x=NULL) +
  annotate("text", x= 1,  y = .25, label = bar.pvals.sig[bar.pvals.sig$Ev==18,]$p.value.growth) +
  annotate("text", x= 2,  y = .25, label = bar.pvals.sig[bar.pvals.sig$Ev==30,]$p.value.growth)

p2<-  ggplot(c.93del, aes(x=as.factor(Ev), y=C.del, fill=as.factor(Ev))) + 
  geom_bar(stat="identity")  +
  geom_errorbar(aes(ymin=C.del-se, ymax=C.del+se), width=.2) +
  scale_fill_manual(values=coldhot) +
   theme(legend.position = "none",
        axis.text.x = element_blank(),
         axis.text.y=element_text(size = labelcex),
        axis.ticks.length = unit(.1, "cm"),
        plot.margin = margin(.1, .1, .1, 1.5, "cm")) +
  labs( y = NULL, x=NULL) +
  annotate("text", x= 1,  y = -4.3, label = bar.pvals.sig[bar.pvals.sig$Ev=="18",]$p.value.c)+
  annotate("text", x= 2,  y = -4.3, label = bar.pvals.sig[bar.pvals.sig$Ev=="30",]$p.value.c)

p3<-ggplot(redf.93del, aes(x=as.factor(Ev), y=redf.del, fill=as.factor(Ev))) + 
  geom_bar(stat="identity")  +
  geom_errorbar(aes(ymin=redf.del-se, ymax=redf.del+se), width=.2) +
  scale_fill_manual(values=coldhot) +
   theme(legend.position = "none",
        axis.text.x = element_blank(),
         axis.text.y=element_text(size = labelcex),
        axis.ticks.length = unit(.1, "cm"),
        plot.margin = margin(.1, .1, .1, 1.5, "cm")) +
labs( y = NULL, x=NULL) +
  annotate("text", x= 1,  y = -3.2, label = bar.pvals.sig[bar.pvals.sig$Ev=="18",]$p.value.redf) +
  annotate("text", x= 2,  y = 8, label = bar.pvals.sig[bar.pvals.sig$Ev=="30",]$p.value.redf)

p4<-ggplot(photopt.93del, aes(x=as.factor(Ev), y=Photo.del, fill=as.factor(Ev))) + 
  geom_bar(position="identity", stat = "identity")  +
  geom_errorbar(aes(ymin=Photo.del-se, ymax=Photo.del+se), width=.2) +
  scale_fill_manual(values=coldhot) +
   theme(legend.position = "none",
        axis.text.x = element_blank(),
         axis.text.y=element_text(size = labelcex),
        axis.ticks.length = unit(.1, "cm"),
        plot.margin = margin(.1, .1, .1, 1.5, "cm")) +
  labs( y = NULL, x=NULL) +
  annotate("text", x= 1,  y = -.225, label = bar.pvals.sig[bar.pvals.sig$Ev=="18",]$p.value.photo) +
  annotate("text", x= 2,  y = -.225, label = bar.pvals.sig[bar.pvals.sig$Ev=="30",]$p.value.photo)

p5<-ggplot(graz.93del, aes(x=as.factor(Ev), y=Grazing.del, fill=as.factor(Ev))) + 
  geom_bar(stat="identity")  +
  geom_errorbar(aes(ymin=Grazing.del-se, ymax=Grazing.del+se), width=.2) +
  scale_fill_manual(values=coldhot) +
   theme(legend.position = "none",
        axis.text.x = element_blank(), 
        axis.text.y=element_text(size = labelcex),
        axis.ticks.length = unit(.1, "cm"),
        plot.margin = margin(.1, .1, .1, 1.5, "cm")) +
 labs( y = NULL, x=NULL)  +
  annotate("text", x= 1,  y = .097, label = bar.pvals.sig[bar.pvals.sig$Ev=="18",]$p.value.graz) +
  annotate("text", x= 2,  y = .097, label = bar.pvals.sig[bar.pvals.sig$Ev=="30",]$p.value.graz)

p6<-ggplot(resp.93del, aes(x=as.factor(Ev), y=Resp.del, fill=as.factor(Ev))) + 
  geom_bar(stat="identity", position = "identity")  +
  geom_errorbar(aes(ymin=Resp.del-se, ymax=Resp.del+se), width=.2) +
  scale_fill_manual(values=coldhot) +
  theme(legend.position = "none",
        axis.text.x = element_blank(),
         axis.text.y=element_text(size = labelcex),
        axis.ticks.length = unit(.1, "cm"),
        plot.margin = margin(.1, .1, .1, 1.5, "cm")) +
  labs( y = NULL, x=NULL) +
  annotate("text", x= 1,  y = -1.3, label = bar.pvals.sig[bar.pvals.sig$Ev=="18",]$p.value.resp) +
  annotate("text", x= 2,  y = -1.4, label = bar.pvals.sig[bar.pvals.sig$Ev=="30",]$p.value.resp)

ggarrange(p1,p2,p3,p4,p5,p6,
         labels = c("A", "B", "C","D",
                     "E","F"),
          nrow = 2, ncol = 3, align = "hv") 

```

Calculate delta values

```{r}
# calculate percent changes and name

#growth
del.gr.18 <- growths100_last3.93 %>% 
  filter(Ev == 18) %>% 
  pull(Growth.del) %>% 
  mean
del.gr.30 <- growths100_last3.93 %>% 
  filter(Ev == 30) %>% 
  pull(Growth.del) %>% 
  mean
val.gr.30 <- growths100_last3 %>% 
  filter(Ev == 24 & Acc == 30) %>% 
  filter(Strain == 1393) %>% 
  pull(Growth.Rate) %>% 
  mean
val.gr.18 <- growths100_last3 %>% 
  filter(Ev == 24 & Acc == 18) %>% 
  filter(Strain == 1393) %>% 
  pull(Growth.Rate) %>% 
  mean

del.redf.18 <- growths100_last3.93 %>% 
  filter(Ev == 18) %>% 
  pull(redf.del) %>% 
  mean
del.redf.30 <- growths100_last3.93 %>% 
  filter(Ev == 30) %>% 
  pull(redf.del) %>% 
  mean
val.redf.30 <- growths100_last3 %>% 
  filter(Ev == 24 & Acc == 30) %>% 
  filter(Strain == 1393) %>% 
  pull(redf) %>% 
  mean
val.redf.18 <- growths100_last3 %>% 
  filter(Ev == 24 & Acc == 18) %>% 
  filter(Strain == 1393) %>% 
  pull(redf) %>% 
  mean

#C
del.C.18 <- cn.100.93 %>% 
  filter(Ev == 18) %>% 
  pull(C.del) %>% 
  mean
del.C.30 <- cn.100.93 %>% 
  filter(Ev == 30) %>% 
  pull(C.del) %>% 
  mean
val.C.30 <- cn.100_last3 %>% 
  filter(Ev == 24 & Acc == 30) %>% 
  filter(Strain == 1393) %>% 
  pull(C) %>% 
  mean
val.C.18 <- cn.100_last3 %>% 
  filter(Ev == 24 & Acc == 18) %>% 
  filter(Strain == 1393) %>% 
  pull(C) %>% 
  mean

#graz
del.graz.18 <- graz100_last3.93 %>% 
  filter(Ev == 18) %>% 
  pull(Grazing.del) %>% 
  mean
del.graz.30 <- graz100_last3.93 %>% 
  filter(Ev == 30) %>% 
  pull(Grazing.del) %>% 
  mean
val.graz.30 <- graz100_last3 %>% 
  filter(Ev == 24 & Acc == 30) %>% 
  filter(Strain == 1393) %>% 
  pull(graz) %>% 
  mean
val.graz.18 <- graz100_last3 %>% 
  filter(Ev == 24 & Acc == 18) %>% 
  filter(Strain == 1393) %>% 
  pull(graz) %>% 
  mean

#Resp/photo
del.resp.18 <- resp.100_last3.93 %>% 
  filter(Ev == 18) %>% 
  pull(Resp.del) %>% 
  mean
del.resp.30 <- resp.100_last3.93 %>% 
  filter(Ev == 30) %>% 
  pull(Resp.del) %>% 
  mean
val.resp.30 <- resp.100_last3 %>% 
  filter(Ev == 24 & Acc == 30) %>% 
  filter(Strain == 1393) %>% 
  pull(Resp) %>% 
  mean
val.resp.18 <- resp.100_last3 %>% 
  filter(Ev == 24 & Acc == 18) %>% 
  filter(Strain == 1393) %>% 
  pull(Resp) %>% 
  mean

del.photo.18 <- resp.100_last3.93 %>% 
  filter(Ev == 18) %>% 
  pull(Photo.del) %>% 
  mean
del.photo.30 <- resp.100_last3.93 %>% 
  filter(Ev == 30) %>% 
  pull(Photo.del) %>% 
  mean
val.photo.30 <- resp.100_last3 %>% 
  filter(Ev == 24 & Acc == 30) %>% 
  filter(Strain == 1393) %>% 
  pull(Photo) %>% 
  mean
val.photo.18 <- resp.100_last3 %>% 
  filter(Ev == 24 & Acc == 18) %>% 
  filter(Strain == 1393) %>% 
  pull(Photo) %>% 
  mean

hotc  <- abs(del.C.30 /val.C.30) *100

hotgraz <- abs(del.graz.30  /val.graz.30) * 100

hotresp <- abs(del.resp.30 / val.resp.30) *100

coldresp<- abs(del.resp.18 / val.resp.18) *100

hotc
hotgraz
hotresp
coldresp
```  

For the obligate mixotroph at high light, which had the strongest evidence for adaptive evolution, we can understand the mechanisms underlying adaptation through comparing traits of the adapted and control lineages at treatment temperatures. These differences illuminate what adaptive evolutionary changes within the cell to account for differences in performance. In the hot-adapted obligate mixotroph, adaptation of increased growth rates at the hot temperature (Fig 3, panel A) was driven by a `r round(hotc,0)`% reduction in carbon per cell (Fig 3, panel B), a `r round(hotgraz,0)`% increase in carbon from grazing (Fig 3, panel E), and `r round(hotresp,0)`% decrease in respiratory costs (Fig 3, panel F) when compared to the control at the hot temperature. Smaller cell sizes means more cells can be made with less carbon, which came from increased grazing and decreased respiratory loses. Carbon fixation was slightly lower (Fig 3 panel D), but chlorophyll content normalized to cell size increased in the hot-adapted lineages (panel C). In cold-adapted lineages, cell sizes and grazing rates did not vary considerably from the control at cold temperatures (Fig 3, panels B and E), but increased growth rates may have been driven by an `r round(coldresp,0)`% decrease in respiratory costs (Fig 3, panel F). 


### THERMAL RESPONSE CURVES

```{r}
#upload thermal response data

pe <- read_csv(here::here("data","pestats_trc3.2.csv")) 
graz <- read_csv(here::here("data","TRC_grazstats_dilution.csv")) 

# grazing pgC per och per day (bact per och per day * C per bact * fg to pgC * 24hrs)
graz$graz.day <- graz$G_O *24 * 113.5996283 * 0.001 

pe$ID.Ev <- paste(pe$Strain,pe$Ev,pe$Rep,sep='.')
graz$ID.Ev <- paste(graz$Strain,graz$Ev,graz$Rep,sep='.')

dat100<- read_csv(here::here("data","OECD100.csv"))
dat100$ID.Ev <- paste(dat100$Strain,dat100$Ev,dat100$Rep,sep='.')
hold1 <- dat100 %>% 
  filter(Strain == 1393) %>% 
  filter(Week == 154) %>% 
  filter(Ev == Acc)
hold1$Mean.redF <- (hold1$Day1.redF + hold1$Day2.redF + hold1$Day3.redF + hold1$Day4.redF) / 4
hold1$redF.corr <- (2.732e-05)*(hold1$Mean.redF) + (6.702e-03) 
pe$redF.corr <- hold1$redF.corr[match(pe$ID.Ev,hold1$ID.Ev)]

hold2 <- dat100 %>% 
  filter(Strain == 1393) %>% 
  filter(Week == 141) %>% 
  filter(Ev == Acc)
pe$pgC.cell <- hold2$pgC.cell[match(pe$ID.Ev,hold2$ID.Ev)]
graz$pgC.cell <-hold2$pgC.cell[match(graz$ID.Ev,hold2$ID.Ev)]

pe$Treat <- paste(pe$Strain,pe$Ev,pe$Assay,sep='.')
graz$Treat <- paste(graz$Strain,graz$Ev,graz$Acc,sep='.')

graz$graz.C.day <- graz$graz.day / graz$pgC.cell

# ETR is in units of electrons per second. Multiplying by per conversion multiplier (0.06332817) and C:CO2 ratio (12/44) and pgChla/cell results in units of pgC fixed per cell per day. Divide by pgC/cell again to get pgC/pgC/day

#pgC per cell per day = ETR * chla(W154redf) * multiplier *12 

pe$cfix <- pe$P_I.interp * pe$redF.corr * 0.06332817 * 12 *(12/44)

#pgC per pgC per day = cfix / C/cell 

pe$cfixperc <- ( pe$P_I.interp * pe$redF.corr * 0.06332817 * 12 *(12/44) ) / pe$pgC.cell

#electrons per pgC per day
#### copy notes from notebook on how you got htis conversion!!!

pe$eperc <- pe$P_I.interp * 0.002 * 6.02e+23 * 0.001119183 * 0.000000001 *60 *60 *12 * (1/pe$redF.corr) * (1/pe$pgC.cell)

ev_cols <- c("18" = lcol2, "24" = mcol2, "30" = hcol2)
```

Photosynthetic capacity using "growthTools"
First, each temperature separately 
Average all reps at each temp with confidence intervals
electrons per pgC per day

```{r}
# calculate each temperature separately

# divide by 10^15 to make units nicer, add this back in in the axis label
pe$eperc2 <- pe$eperc / 10^15

#	Single	data	set:
new.grids<-list(topt=seq(20,40,5),w=seq(10,40,5),a=seq(1,-1,-0.5),b=c(-0.05,0,0.05))
new.start<-list(topt=NA,w=NA,a=NA,b=NA,s=log(2))   

sp1_pi3	<- pe	%>% 
  filter(Ev == "18")
nbcurve.traits_pi3	<- get.nbcurve.tpc(sp1_pi3$Assay,	sp1_pi3$eperc2,	method	=
"grid.mle2", grids=new.grids,start=new.start)

sp2_pi3	<- pe	%>% 
  filter(Ev == "24")
nbcurve.traits2_pi3	<- get.nbcurve.tpc(sp2_pi3$Assay,	sp2_pi3$eperc2,	method	=
"grid.mle2", grids=new.grids,start=new.start)

sp3_pi3	<- pe	%>% 
  filter(Ev == "30")
nbcurve.traits3_pi3	<- get.nbcurve.tpc(sp3_pi3$Assay,	sp3_pi3$eperc2,	method	=
"grid.mle2", grids=new.grids,start=new.start)

plot(nbcurve.traits_pi3,xlim=c(0,45))
plot(nbcurve.traits2_pi3,xlim=c(0,45))
plot(nbcurve.traits3_pi3,xlim=c(0,45))

nbcurve.traits_pi3$topt
nbcurve.traits2_pi3$topt
nbcurve.traits3_pi3$topt

nbcurve.traits_pi3$tmax
nbcurve.traits2_pi3$tmax
nbcurve.traits3_pi3$tmax

```

Then temp by color on same plot with confidence intervals, topt, and tmax
Grouped by temp with confidence intervals
e^-1 per pgC

Plot figure 5A
```{r}
#Predict values from a tpc
tmp18_pi3	<- predict(nbcurve.traits_pi3,	se.fit	=	T, newdata = data.frame(temperature=seq(0,45,0.1)))
tmp24_pi3 <- predict(nbcurve.traits2_pi3,	se.fit	=	T, newdata = data.frame(temperature=seq(0,45,0.1)))
tmp30_pi3 <- predict(nbcurve.traits3_pi3,	se.fit	=	T, newdata = data.frame(temperature=seq(0,45,0.1)))

theme_set(theme_base(base_size = 10)) 
theme_update(plot.background=element_blank())

#	plot	the	predictions
ggplot(tmp18_pi3,	aes(x	=	temperature,	y	=	mu))	+ 
  geom_ribbon(aes(ymin	=	mu	- 1.96 * se.fit,	ymax	=	mu	+ 1.96 * se.fit),	
              fill	= newcols[1],alpha =.4)	+
	geom_line(color =newcols[1] )	+ 
  coord_cartesian(xlim = c(0,50),ylim	= c(-.2,	4.5))	+ 
  scale_x_continuous("")	+ scale_y_continuous("")	+
  geom_hline(yintercept = 0)+
  geom_ribbon(data = tmp24_pi3, aes(ymin	=	mu	-	1.96 * se.fit,	ymax	=	mu	+ 1.96 * se.fit),	
              fill	= newcols[2],alpha =.4)	+
	geom_line(data = tmp24_pi3, color = newcols[2])	+ 
  geom_ribbon(data = tmp30_pi3, aes(ymin	=	mu	- 1.96 * se.fit,	ymax	=	mu	+ 1.96 * se.fit),	
              fill	= newcols[3],alpha =.4)	+
	geom_line(data = tmp30_pi3, color = newcols[3])	+
  geom_vline(xintercept	= nbcurve.traits_pi3$topt, color = newcols[1])	+
  geom_vline(xintercept	= nbcurve.traits2_pi3$topt, color = newcols[2])	+
  geom_vline(xintercept	= nbcurve.traits3_pi3$topt, color = newcols[3])	+
  geom_vline(xintercept	= nbcurve.traits_pi3$tmax, color = newcols[1] )	+
  geom_vline(xintercept	= nbcurve.traits2_pi3$tmax, color = newcols[2])	+
  geom_vline(xintercept	= nbcurve.traits3_pi3$tmax, color = newcols[3]) + 
  geom_point(data	=	sp1_pi3, aes(x = Assay, y = eperc2),	color = lcol2,alpha	= 0.4) +
   geom_point(data	=	sp2_pi3, aes(x = Assay, y = eperc2),	color = "grey",alpha	= 0.4) +
   geom_point(data	=	sp3_pi3, aes(x = Assay, y = eperc2),	color = hcol2,alpha	= 0.4) +
  theme(legend.position = "none",
        axis.text.y=element_text(size = 11),
        axis.text.x=element_text(size = 11),
        axis.ticks.length = unit(.1, "cm")) 
  
  
```

Smooth spline for fvfm and grazing
Plot Figure 5B and Figure S4

```{r}
 
# geom smooth using loess and default span of .75
  ggplot(pe, aes(x = Assay, y = Fv.Fm)) +
  geom_point(aes(color = as.factor(Ev)), alpha = .4) +
               scale_color_manual(values = newcols)+
   geom_smooth(aes(x = Assay, y = Fv.Fm, color = as.factor(Ev),fill = as.factor(Ev)), alpha = .4, method = "loess", span = .75, size = .5) +
     scale_fill_manual(values = newcols) +
  geom_hline(yintercept = 0)+
theme(legend.position = "none",
        axis.text.y=element_text(size = 11),
        axis.text.x=element_text(size = 11),
        axis.ticks.length = unit(.1, "cm")) 
  

#grazing
   ggplot(graz, aes(x = Assay, y = graz.C.day)) +
  geom_point(aes(color = as.factor(Ev)), alpha = .5, size = 1.5) +
               scale_color_manual(values = newcols)+
   geom_smooth(aes(x = Assay, y = graz.C.day, color = as.factor(Ev),fill = as.factor(Ev)),alpha = .4, method = "loess", span = .75, size = .5) +
     scale_fill_manual(values = newcols) +
     geom_hline(yintercept = 0)+
     theme(legend.position = "none",
        axis.text.y=element_text(size = 11),
        axis.text.x=element_text(size = 11),
        axis.ticks.length = unit(.1, "cm")) 
  
```

### Supporting Information

Figure S2 all growth rates from back transfer experiments 

```{r,fig.height= 3, fig.width= 8}
growths100 <-growths100 %>% 
  filter(Strain!= 1391)
Growth.summ.100.time <- summarySE(data=growths100,measurevar='Growth.Rate',groupvars=c('Strain','Ev','Acc','Week'))
redf.corr.summ.100.time <- summarySE(data=growths100,measurevar='redf.corr',groupvars=c('Strain','Ev','Acc','Week'))

Growth.summ.100.1393.time <- Growth.summ.100.time %>% 
  filter(Strain == 1393)
Growth.summ.100.2951.time <- Growth.summ.100.time %>% 
  filter(Strain == 2951)
redf.corr.summ.100.1393.time <- redf.corr.summ.100.time %>% 
  filter(Strain == 1393)
redf.corr.summ.100.2951.time <- redf.corr.summ.100.time %>% 
  filter(Strain == 2951)

growths50 <-growths50 %>% 
  filter(Strain!= 1391)
Growth.summ.50.time <- summarySE(data=growths50,measurevar='Growth.Rate',groupvars=c('Strain','Ev','Acc','Week'))
redf.corr.summ.50.time <- summarySE(data=growths50,measurevar='redf.corr',groupvars=c('Strain','Ev','Acc','Week'))

Growth.summ.50.1393.time <- Growth.summ.50.time %>% 
  filter(Strain == 1393)
Growth.summ.50.2951.time <- Growth.summ.50.time %>% 
  filter(Strain == 2951)
redf.corr.summ.50.1393.time <- redf.corr.summ.50.time %>% 
  filter(Strain == 1393)
redf.corr.summ.50.2951.time <- redf.corr.summ.50.time %>% 
  filter(Strain == 2951)


theme_set(theme_base(base_size = 10)) 
theme_update(plot.background=element_blank())


s1.1<- ggplot(Growth.summ.100.1393.time, 
       aes(x=Acc, y=Growth.Rate, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se), width=1) +
    geom_line(lwd = 1) +
    geom_point(size = 3)+
   facet_grid(cols = vars(Week)) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
    theme(legend.position = "none",
          strip.text = element_blank()) +
    theme(axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_blank(),
        axis.text.y=element_text(size = 11),
        axis.ticks.length = unit(.1, "cm") ,
    panel.spacing = unit(0,'lines'),
        plot.margin = margin(.1, .1, -.2, .5, "cm"))
  
s1.2<- ggplot(Growth.summ.50.1393.time, 
       aes(x=Acc, y=Growth.Rate, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se), width=1) +
    geom_line(lwd = 1) +
    geom_point(size = 3)+
   facet_grid(cols = vars(Week)) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
    theme(legend.position = "none",
          strip.text = element_blank()) +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_blank(),
        axis.text.y=element_text(size = 11),
        axis.ticks.length = unit(.1, "cm") ,
    panel.spacing = unit(0,'lines'),
        plot.margin = margin(.1, .1, -.2, .5, "cm"))

s1.3<- ggplot(Growth.summ.100.2951.time, 
       aes(x=Acc, y=Growth.Rate, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se), width=1) +
    geom_line(lwd = 1) +
    geom_point(size = 3)+
   facet_grid(cols = vars(Week)) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
    theme(legend.position = "none",
          strip.text = element_blank()) +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.title.y=element_blank(),
        axis.ticks.length = unit(.1, "cm") ,
        axis.text.y=element_text(size = 11),
    panel.spacing = unit(0,'lines'),
        plot.margin = margin(.1, .1, -.2, .5, "cm")) 
  
s1.4<- ggplot(Growth.summ.50.2951.time, 
       aes(x=Acc, y=Growth.Rate, color=as.factor(Ev))) + 
    geom_errorbar(aes(ymin=Growth.Rate-se, ymax=Growth.Rate+se), width=1) +
    geom_line(lwd = 1) +
    geom_point(size = 3)+
   facet_grid(cols = vars(Week)) +
    scale_color_manual(values=newcols) +
    scale_x_continuous(limits = c(17,31),
                     breaks = c(18,24,30),
                     expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
    theme(legend.position = "none",
          strip.text = element_blank()) +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.ticks.length = unit(.1, "cm") ,
        axis.text.y=element_text(size = 11),
        axis.text.x=element_text(size = 11),
    panel.spacing = unit(0,'lines'),
        plot.margin = margin(.1, .1, .1, .5, "cm")) 
  

# order 1393 100, 1393 50, 2951 100, 2951 50

ggarrange(s1.1, s1.2, s1.3,s1.4,
   labels = c("A", "B", "C","D"),
   font.label = list(size = 12, color = "black", family = NULL),
          label.x = 0,
          label.y = 1,
          ncol = 1, nrow = 4,align="hv" )

# ggarrange(s1.1, s1.2, 
#    labels = c("A", "B"),
#    font.label = list(size = 12, color = "black", family = NULL),
#           label.x = 0,
#           label.y = 1,
#           ncol = 1, nrow = 2,align="hv" )
# ggarrange(s1.3,s1.4,
#    labels = c("C","D"),
#    font.label = list(size = 12, color = "black", family = NULL),
#           label.x = 0,
#           label.y = 1,
#           ncol = 1, nrow = 2,align="hv" )

```


Figure S1. QAQC showing correlation from extracted chl-a to redf

```{r}
qaqc<-read_csv(here::here("data","QAQC_data_Jan2021 - Export data.csv"))

plot(qaqc$RedF,qaqc$ChlperCell,pch=21,bg=c('gray80','black')[as.factor(qaqc$Strain)],xlab='Red Fluorescence (Guava)',ylab='Chlorophyll per cell (acetone)',las=1)
legend(3000,.5,pch=21,pt.bg=c('gray80','black'),legend=c('1393','2951'))

lm.redF.93 <- lm(ChlperCell~RedF,data=qaqc[qaqc$Strain==1393,])
summary(lm.redF.93)

lm.redF.51 <- lm(ChlperCell~RedF,data=qaqc[qaqc$Strain==2951,])
summary(lm.redF.51)

lm.93<-qaqc %>% 
  filter(Strain == "1393") 

lm_eqn93 <- function(lm.93){
    m <- lm(ChlperCell ~ RedF, lm.93);
    eq <- substitute("Strain 1393:"~~italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
lm.51<-qaqc %>% 
  filter(Strain == "2951") 

lm_eqn51 <- function(lm.51){
    m <- lm(ChlperCell ~ RedF, lm.51);
    eq <- substitute("Strain 2951:"~~italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}

ggplot(qaqc, aes(x = RedF, y = ChlperCell, fill = as.factor(Strain)))+
  geom_point(size = 2.5, shape = 21) +
  scale_fill_manual(values = c("gray80","black")) +
  geom_abline(intercept = coefficients(lm.redF.93)[1], slope = coefficients(lm.redF.93)[2], color = "gray80") +
  geom_abline(intercept = coefficients(lm.redF.51)[1], slope = coefficients(lm.redF.51)[2], color = "black")  +
theme(legend.position = "NONE",
       axis.ticks.length = unit(.10, "cm")) +
labs( y ="Chlorophyll per cell", x="Red fluorescence") +
   geom_text(x = 3000, y = .5, label = lm_eqn93(lm.93), parse = TRUE, color = "gray50", hjust = "left", size = 3.5)+
  geom_text(x = 3000, y = .45, label = lm_eqn51(lm.51), parse = TRUE, hjust= "left", size = 3.5)

```

